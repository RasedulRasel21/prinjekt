<script src="https://unpkg.com/feather-icons" defer></script>
<script src="{{ 'prinjekt-configurator-master-logic.js' | asset_url }}" defer></script>

{%- liquid
  assign api_base = section.settings.api_base_url
  assign viewer_bg = section.settings.viewer_background
  assign show_grid = section.settings.show_grid
  assign show_axes = section.settings.show_axes
  assign show_shadows = section.settings.show_shadows
  assign auto_rotate = section.settings.auto_rotate
  assign default_price = section.settings.default_price
  assign shipping_time = section.settings.shipping_time
  assign mobile_sheet_height = section.settings.mobile_sheet_height
-%}

<div id="prinjekt-root-{{ section.id }}" class="prinjekt-app" style="
  --container-max-width: {{ section.settings.container_max_width }}px;
  --container-padding: {{ section.settings.container_padding }}px;
  --column-gap: {{ section.settings.column_gap }}px;
  --row-gap: {{ section.settings.row_gap }}px;
  
  --viewer-aspect-ratio: {{ section.settings.viewer_aspect_ratio }};
  --viewer-aspect-ratio-mobile: {{ section.settings.viewer_aspect_ratio_mobile }};
  --viewer-border-radius: {{ section.settings.viewer_border_radius }}px;
  --viewer-shadow: {{ section.settings.viewer_shadow_x }}px {{ section.settings.viewer_shadow_y }}px {{ section.settings.viewer_shadow_blur }}px {{ section.settings.viewer_shadow_spread }}px rgba(0,0,0,{{ section.settings.viewer_shadow_opacity | divided_by: 100.0 }});
  
  --card-bg: {{ section.settings.card_bg_color }};
  --card-border-radius: {{ section.settings.card_border_radius }}px;
  --card-padding: {{ section.settings.card_padding }}px;
  --card-margin-bottom: {{ section.settings.card_margin_bottom }}px;
  --card-shadow: {{ section.settings.card_shadow_x }}px {{ section.settings.card_shadow_y }}px {{ section.settings.card_shadow_blur }}px {{ section.settings.card_shadow_spread }}px rgba(0,0,0,{{ section.settings.card_shadow_opacity | divided_by: 100.0 }});
  
  --text-color-primary: {{ section.settings.text_color_primary }};
  --text-color-secondary: {{ section.settings.text_color_secondary }};
  --text-color-muted: {{ section.settings.text_color_muted }};
  
  --title-font-size: {{ section.settings.title_font_size }}px;
  --title-font-weight: {{ section.settings.title_font_weight }};
  --title-line-height: {{ section.settings.title_line_height }};
  
  --subtitle-font-size: {{ section.settings.subtitle_font_size }}px;
  --subtitle-font-weight: {{ section.settings.subtitle_font_weight }};
  
  --price-font-size: {{ section.settings.price_font_size }}px;
  --price-font-weight: {{ section.settings.price_font_weight }};
  --price-color: {{ section.settings.price_color }};
  
  --button-primary-bg: {{ section.settings.button_primary_bg }};
  --button-primary-text: {{ section.settings.button_primary_text }};
  --button-primary-radius: {{ section.settings.button_primary_radius }}px;
  --button-primary-padding-y: {{ section.settings.button_primary_padding_y }}px;
  --button-primary-padding-x: {{ section.settings.button_primary_padding_x }}px;
  --button-primary-font-size: {{ section.settings.button_primary_font_size }}px;
  
  --button-secondary-bg: {{ section.settings.button_secondary_bg }};
  --button-secondary-text: {{ section.settings.button_secondary_text }};
  --button-secondary-radius: {{ section.settings.button_secondary_radius }}px;
  --button-secondary-padding-y: {{ section.settings.button_secondary_padding_y }}px;
  --button-secondary-padding-x: {{ section.settings.button_secondary_padding_x }}px;
  
  --input-bg: {{ section.settings.input_bg }};
  --input-border: {{ section.settings.input_border }};
  --input-border-width: {{ section.settings.input_border_width }}px;
  --input-border-radius: {{ section.settings.input_border_radius }}px;
  --input-padding-y: {{ section.settings.input_padding_y }}px;
  --input-padding-x: {{ section.settings.input_padding_x }}px;
  --input-font-size: {{ section.settings.input_font_size }}px;
  
  --param-item-bg: {{ section.settings.param_item_bg }};
  --param-item-border: {{ section.settings.param_item_border }};
  --param-item-radius: {{ section.settings.param_item_radius }}px;
  --param-item-padding: {{ section.settings.param_item_padding }}px;
  --param-item-margin-bottom: {{ section.settings.param_item_margin_bottom }}px;
  
  --slider-height: {{ section.settings.slider_height }}px;
  --slider-thumb-size: {{ section.settings.slider_thumb_size }}px;
  --slider-thumb-size-mobile: {{ section.settings.slider_thumb_size_mobile }}px;
  --slider-track-color: {{ section.settings.slider_track_color }};
  --slider-thumb-color: {{ section.settings.slider_thumb_color }};
  
  --badge-bg: {{ section.settings.badge_bg }};
  --badge-text: {{ section.settings.badge_text }};
  --badge-padding-y: {{ section.settings.badge_padding_y }}px;
  --badge-padding-x: {{ section.settings.badge_padding_x }}px;
  --badge-font-size: {{ section.settings.badge_font_size }}px;
  --badge-border-radius: {{ section.settings.badge_border_radius }}px;
  
  --bg-gradient-from: {{ section.settings.bg_gradient_from }};
  --bg-gradient-to: {{ section.settings.bg_gradient_to }};
  
  --transition-speed: {{ section.settings.transition_speed }}ms;
  
  --mobile-sheet-height: {{ mobile_sheet_height }}vh;
  --mobile-sheet-bg: {{ section.settings.mobile_sheet_bg }};
  --mobile-sheet-radius: {{ section.settings.mobile_sheet_radius }}px;
  --mobile-sticky-bar-height: {{ section.settings.mobile_sticky_bar_height }}px;
  --mobile-sheet-handle-bg: {{ section.settings.mobile_sheet_handle_bg }};
">
  <div class="prinjekt-container">
    <div class="prinjekt-viewer-wrapper">
      <div class="viewer-card">
        <div class="viewer-display" style="background: linear-gradient(to bottom right, {{ viewer_bg }}, {{ section.settings.viewer_gradient_to }});">
          
          <div class="viewer-grid" {% unless show_grid %}style="display:none;"{% endunless %}></div>
          <canvas id="canvas-{{ section.id }}" class="viewer-canvas" aria-label="3D Product Preview"></canvas>
          
          <div id="placeholder-{{ section.id }}" class="viewer-placeholder">
            <div class="placeholder-loader">
              <div class="cube-loader">
                <div class="cube-face cube-front"></div>
                <div class="cube-face cube-back"></div>
                <div class="cube-face cube-right"></div>
                <div class="cube-face cube-left"></div>
                <div class="cube-face cube-top"></div>
                <div class="cube-face cube-bottom"></div>
              </div>
            </div>
            <p class="placeholder-loading-text">{{ section.settings.placeholder_loading_text | default: "Loading 3D model..." }}</p>
            <p class="placeholder-loading-subtext">{{ section.settings.placeholder_loading_subtext | default: "Preparing your configuration" }}</p>
          </div>
          
          <div id="loading-{{ section.id }}" class="viewer-loading">
            <div class="loading-spinner"></div>
            <p id="loading-text-{{ section.id }}" class="loading-text">{{ section.settings.loading_text }}</p>
          </div>
          <div id="canvas-update-btn-{{ section.id }}" class="canvas-update-btn-wrapper">
            <button class="canvas-update-btn">
              <i data-feather="zap"></i>
              <span>{{ section.settings.update_preview_text | default: "Update Preview" }}</span>
            </button>
          </div>
          
          <!-- Simplified: Only 2 Buttons -->
          <div class="viewer-settings-btn-wrapper">
            <button id="fullscreen-btn-{{ section.id }}" class="settings-btn" aria-label="Fullscreen view" title="Fullscreen">
              <i data-feather="maximize"></i>
            </button>
            <button id="settings-btn-{{ section.id }}" class="settings-btn" aria-label="More options" title="More Options">
              <i data-feather="menu"></i>
            </button>
          </div>
          
          <!-- Unified Menu Dropdown -->
          <div id="settings-menu-{{ section.id }}" class="settings-dropdown" style="width: 280px;">
            <!-- Camera Controls -->
            <div class="settings-header">CAMERA</div>
            <button class="settings-action" id="reset-view-btn-{{ section.id }}">
              <i data-feather="home"></i>
              <span>{{ section.settings.reset_camera_text | default: "Reset Camera View" }}</span>
            </button>
            
            <!-- Viewer Settings -->
            <div class="settings-divider"></div>
            <div class="settings-header">{{ section.settings.settings_menu_title | default: "VIEWER SETTINGS" }}</div>
            <button class="settings-option" data-setting="grid">
              <i data-feather="grid"></i>
              <span>{{ section.settings.settings_grid_label }}</span>
              <span class="settings-check">âœ“</span>
            </button>
            <button class="settings-option" data-setting="axes">
               <i data-feather="compass"></i>
              <span>{{ section.settings.settings_axes_label }}</span>
              <span class="settings-check">âœ“</span>
            </button>
            <button class="settings-option" data-setting="autoRotate">
              <i data-feather="rotate-cw"></i>
              <span>{{ section.settings.settings_rotate_label }}</span>
              <span class="settings-check">âœ“</span>
            </button>
            <button class="settings-option" data-setting="wireframe">
              <i data-feather="codepen"></i> <span>{{ section.settings.settings_wireframe_label }}</span>
              <span class="settings-check">âœ“</span>
            </button>
            
            <!-- Save/Load Configuration -->
            <div class="settings-divider"></div>
            <div class="settings-header">CONFIGURATION</div>
            <button class="settings-action" id="save-config-btn-{{ section.id }}">
              <i data-feather="download"></i>
              <span>{{ section.settings.save_config_text | default: "Save Configuration" }}</span>
            </button>
            <button class="settings-action" id="load-config-btn-{{ section.id }}">
              <i data-feather="upload"></i>
              <span>{{ section.settings.load_config_text | default: "Load Configuration" }}</span>
            </button>
            
            <!-- Help Section -->
            <div class="settings-divider"></div>
            <div class="settings-header">{{ section.settings.help_menu_title | default: "HELP & CONTROLS" }}</div>
            <div class="help-content" style="padding: 0.5rem;">
              <div class="help-item">
                <i data-feather="mouse-pointer"></i>
                <span>{{ section.settings.help_rotate | default: "Click & drag to rotate" }}</span>
              </div>
              <div class="help-item">
                <i data-feather="maximize-2"></i>
                <span>{{ section.settings.help_zoom | default: "Scroll to zoom in/out" }}</span>
              </div>
              <div class="help-item">
                <i data-feather="move"></i>
                <span>{{ section.settings.help_pan | default: "Right-click & drag to pan" }}</span>
              </div>
              <div class="help-item">
                <i data-feather="smartphone"></i>
                <span>{{ section.settings.help_touch | default: "Pinch to zoom on mobile" }}</span>
              </div>
            </div>
          </div>
          
          <div id="model-status-{{ section.id }}" class="viewer-model-status">
            <span class="status-indicator"></span>
            {{ section.settings.model_loaded_text }}
          </div>
        </div>
        
        <!-- REMOVED Info Bar - Not needed in new design -->
        
      </div>
      
      <!-- USP Section under viewer -->
      <div class="viewer-usp-section">
        <div class="usp-item">
          <div class="usp-icon">
            <i data-feather="clock"></i>
          </div>
          <div class="usp-content">
            <p class="usp-title">{{ section.settings.usp_1_title | default: "Fast Production" }}</p>
            <p class="usp-description">{{ section.settings.usp_1_description | default: "Ready to ship in 5-7 business days" }}</p>
          </div>
        </div>
        <div class="usp-item">
          <div class="usp-icon">
            <i data-feather="package"></i>
          </div>
          <div class="usp-content">
            <p class="usp-title">{{ section.settings.usp_2_title | default: "Free Shipping" }}</p>
            <p class="usp-description">{{ section.settings.usp_2_description | default: "Free delivery on all orders" }}</p>
          </div>
        </div>
        <div class="usp-item">
          <div class="usp-icon">
            <i data-feather="shield"></i>
          </div>
          <div class="usp-content">
            <p class="usp-title">{{ section.settings.usp_3_title | default: "Quality Guarantee" }}</p>
            <p class="usp-description">{{ section.settings.usp_3_description | default: "100% satisfaction or money back" }}</p>
          </div>
        </div>
      </div>
      
      <!-- REMOVED Helper Text -->
      
    </div>
    <div id="mobile-sticky-bar-{{ section.id }}" class="mobile-sticky-bar">
      <div class="mobile-bar-content">
        <div class="mobile-bar-price">
          <span class="mobile-price-label">{{ section.settings.mobile_price_label }}</span>
          <span id="mobile-price-{{ section.id }}" class="mobile-price-value">â‚¬{{ default_price }}</span>
        </div>
        <button id="mobile-configure-btn-{{ section.id }}" class="mobile-configure-btn">
          <i data-feather="sliders"></i>
          <span>{{ section.settings.mobile_configure_text }}</span>
        </button>
      </div>
    </div>
    <div id="mobile-backdrop-{{ section.id }}" class="mobile-backdrop"></div>
    <div id="config-panel-{{ section.id }}" class="prinjekt-config-wrapper">
      <div class="mobile-sheet-handle">
        <div class="sheet-handle-bar"></div>
      </div>
      
      <div class="config-card header-card">
        <div class="header-row">
          <div class="header-content">
            <h1 class="product-title">{{ product.title | default: section.settings.product_title_fallback }}</h1>
            <p class="product-description">{{ section.settings.product_description }}</p>
          </div>
        </div>
      </div>
      
      <div class="config-card params-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h2 class="params-heading" style="margin-bottom: 0;">{{ section.settings.params_heading }}</h2>
          <button 
            id="reset-btn-{{ section.id }}" 
            title="{{ section.settings.reset_params_title | default: 'Reset all parameters to default' }}"
            style="display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.5rem 0.875rem; background: transparent; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 13px; color: #6b7280; cursor: pointer; transition: all 0.2s ease; font-family: inherit; line-height: 1; white-space: nowrap;"
            onmouseover="this.style.background='#f9fafb'; this.style.borderColor='#d1d5db'; this.style.color='#374151';"
            onmouseout="this.style.background='transparent'; this.style.borderColor='#e5e7eb'; this.style.color='#6b7280';"
          >
            <i data-feather="rotate-ccw" style="width: 14px; height: 14px; flex-shrink: 0;"></i>
            <span style="line-height: 1;">{{ section.settings.reset_params_text | default: "Reset All" }}</span>
          </button>
        </div>
        
        <div id="params-container-{{ section.id }}" class="params-list">
          <div class="skeleton-loader">
            <div class="skeleton-item"></div>
            <div class="skeleton-item"></div>
            <div class="skeleton-item"></div>
          </div>
        </div>
        
        <!-- Update Button REMOVED: Redundant, canvas button is sufficient -->
      </div>
      
      <div class="config-card cta-card">
        <div class="cta-row">
          <div>
            <p class="cta-label">{{ section.settings.total_price_label }}</p>
            <p id="price-footer-{{ section.id }}" class="cta-value">â‚¬{{ default_price }}</p>
          </div>
          <div class="cta-delivery">
            <p class="cta-label">{{ section.settings.delivery_label }}</p>
            <p class="cta-value">{{ shipping_time }}</p>
          </div>
        </div>
        
        <button id="cart-btn-{{ section.id }}" class="add-to-cart-btn">
          <i data-feather="shopping-cart"></i>
          <span>{{ section.settings.add_to_cart_text }}</span>
        </button>
        
        <p id="cart-warning-{{ section.id }}" class="cart-warning">
          {{ section.settings.cart_warning_text }}
        </p>
      </div>
      
    </div>
  </div>
  <div id="fullscreen-overlay-{{ section.id }}" class="fullscreen-overlay">
    <button id="fullscreen-reset-view-{{ section.id }}" class="fullscreen-reset-btn" aria-label="Reset camera view" title="ZurÃ¼ck zur Standard-Ansicht">
      <i data-feather="home"></i>
    </button>
    <button id="fullscreen-close-{{ section.id }}" class="fullscreen-close-btn" aria-label="Close fullscreen">
      <i data-feather="x"></i>
    </button>
    <div class="fullscreen-viewer"></div>
  </div>
  
  <div id="toast-{{ section.id }}" class="toast-notification"></div>
</div>

<style>
.prinjekt-app {
  font-family: var(--font-body-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
  -webkit-font-smoothing: antialiased;
  min-height: 100vh;
  background: linear-gradient(to bottom right, var(--bg-gradient-from), var(--bg-gradient-to));
  z-index: -0;
}

/* Smooth scrolling for better UX */
@media (max-width: 1023px) {
  html {
    scroll-behavior: smooth;
  }
}

.prinjekt-app *, 
.prinjekt-app *::before, 
.prinjekt-app *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

.prinjekt-app [data-feather] {
  width: 20px;
  height: 20px;
  stroke-width: 2;
}

.reset-button [data-feather],
.shipping-item [data-feather],
.settings-option [data-feather] {
  width: 16px;
  height: 16px;
}

.prinjekt-container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  position: relative;
}

/* Mobile: Add subtle gap between viewer and config */
@media (max-width: 1023px) {
  .prinjekt-container {
    gap: 0.5rem;
    background: var(--bg-gradient-from);
  }
}

/* Desktop: 2-column Grid Layout */
@media (min-width: 1024px) {
  .prinjekt-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    max-width: var(--container-max-width);
    margin: 0 auto;
    padding: 2rem;
    min-height: auto;
  }
}

/* Mobile: Sticky Viewer that scrolls with config panel */
@media (max-width: 1023px) {
  .prinjekt-viewer-wrapper {
    position: sticky;
    top: 0;
    width: 100%;
    height: 40vh;
    background: var(--bg-gradient-from);
    padding: 16px;
    padding-bottom: 16px;
    margin-bottom: 0;
    z-index: 1;
    border-radius: 16px;
    /* Prevent scroll interference */
    touch-action: pan-y;
    user-select: none;
    -webkit-user-select: none;
  }
  
  .prinjekt-viewer-wrapper .viewer-card {
    height: 100%;
  }
  
  .prinjekt-viewer-wrapper .viewer-display {
    height: 100%;
    aspect-ratio: unset !important; /* Remove aspect ratio on mobile */
    /* Prevent zoom on scroll - touch-action: none on canvas is sufficient */
    touch-action: none;
  }
  
  .prinjekt-viewer-wrapper .viewer-usp-section {
    display: none;
  }
}

/* Desktop: Sticky Viewer */
@media (min-width: 1024px) {
  .prinjekt-viewer-wrapper {
    position: sticky;
    top: 2rem;
    align-self: flex-start;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
}
.viewer-card {
  background: var(--card-bg);
  border-radius: var(--viewer-border-radius);
  box-shadow: var(--viewer-shadow);
  overflow: visible;
}

.viewer-display {
  position: relative;
  overflow: visible;
}

/* Desktop: Use desktop aspect ratio */
@media (min-width: 1024px) {
  .viewer-display {
    aspect-ratio: var(--viewer-aspect-ratio);
  }
}

.viewer-grid {
  position: absolute;
  inset: 0;
  opacity: 0.2;
  background-image: 
    linear-gradient(to right, #e5e7eb 1px, transparent 1px),
    linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events: none;
  border-radius: var(--viewer-border-radius);
}

.viewer-canvas {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  touch-action: none;
  transition: filter var(--transition-speed) ease, opacity var(--transition-speed) ease;
  border-radius: var(--viewer-border-radius);
}
.viewer-canvas.blurred {
  filter: blur(8px);
  opacity: 0.6;
  pointer-events: none;
}

.viewer-placeholder {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-radius: var(--viewer-border-radius);
  text-align: center;
  padding: 2rem;
  z-index: 2;
  pointer-events: none;
}
.placeholder-loader {
  perspective: 800px;
  margin-bottom: 2rem;
}

.cube-loader {
  width: 80px;
  height: 80px;
  position: relative;
  transform-style: preserve-3d;
  animation: rotateCube 3s infinite ease-in-out;
}

.cube-face {
  position: absolute;
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, rgba(245, 158, 11, 0.8), rgba(251, 191, 36, 0.6));
  border: 2px solid rgba(245, 158, 11, 0.3);
  box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
  opacity: 0.9;
}

.cube-front  { transform: rotateY(0deg) translateZ(40px); }
.cube-back   { transform: rotateY(180deg) translateZ(40px); }
.cube-right  { transform: rotateY(90deg) translateZ(40px); }
.cube-left   { transform: rotateY(-90deg) translateZ(40px); }
.cube-top    { transform: rotateX(90deg) translateZ(40px); }
.cube-bottom { transform: rotateX(-90deg) translateZ(40px); }

@keyframes rotateCube {
  0% {
    transform: rotateX(0deg) rotateY(0deg);
  }
  50% {
    transform: rotateX(180deg) rotateY(180deg);
  }
  100% {
    transform: rotateX(360deg) rotateY(360deg);
  }
}

.placeholder-loading-text {
  color: var(--text-color-primary);
  font-weight: 600;
  margin-bottom: 0.5rem;
  font-size: var(--subtitle-font-size);
  animation: pulse 2s ease-in-out infinite;
}

.placeholder-loading-subtext {
  font-size: calc(var(--subtitle-font-size) * 0.9);
  color: var(--text-color-secondary);
  animation: pulse 2s ease-in-out infinite;
  animation-delay: 0.3s;
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

.viewer-loading {
  position: absolute;
  inset: 0;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(4px);
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  z-index: 100;
  border-radius: var(--viewer-border-radius);
}

.viewer-loading.active {
  display: flex;
}

.loading-spinner {
  width: 48px;
  height: 48px;
  border: 4px solid #e5e7eb;
  border-top-color: var(--text-color-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loading-text {
  font-size: var(--subtitle-font-size);
  color: var(--text-color-secondary);
}
.canvas-update-btn-wrapper {
  position: absolute;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 15;
  pointer-events: none;
  transition: padding var(--transition-speed) ease;
}

.canvas-update-btn-wrapper.active {
  display: flex;
}

.canvas-update-btn {
  padding: 1rem 2rem;
  background: var(--button-secondary-bg);
  color: var(--button-secondary-text);
  border: none;
  border-radius: var(--button-secondary-radius);
  font-size: var(--button-primary-font-size);
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  cursor: pointer;
  box-shadow: 0 10px 40px -10px rgba(245, 158, 11, 0.4), 0 4px 12px rgba(245, 158, 11, 0.3);
  transition: all var(--transition-speed) ease;
  pointer-events: auto;
  animation: pulse-button 2s ease-in-out infinite;
}

.canvas-update-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 12px 48px -12px rgba(245, 158, 11, 0.5), 0 6px 16px rgba(245, 158, 11, 0.4);
  filter: brightness(1.1);
}

.canvas-update-btn:active {
  transform: scale(0.98);
}

.canvas-update-btn svg {
  width: 20px;
  height: 20px;
}

.canvas-update-btn.loading svg {
  animation: rotate 0.8s linear infinite;
}

@keyframes pulse-button {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.03);
  }
}

@keyframes rotate {
  to { transform: rotate(360deg); }
}

.viewer-settings-btn-wrapper {
  position: absolute;
  top: 1rem;
  right: 1rem;
  z-index: 20;
  display: flex;
  gap: 0.5rem;
}

.settings-btn {
  width: 48px;
  height: 48px;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(4px);
  border: 1px solid #e5e7eb;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
  color: var(--text-color-primary);
  transition: all var(--transition-speed) ease;
  pointer-events: auto;
}

.settings-btn:hover {
  background: white;
  transform: scale(1.05);
}

.settings-dropdown {
  position: fixed;
  background: var(--card-bg, #ffffff);
  border: var(--input-border-width) solid var(--input-border);
  border-radius: var(--card-border-radius);
  box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
  padding: 0.5rem;
  width: 200px;
  z-index: 1000;
  display: none;
  font-family: var(--font-body-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
}

.settings-dropdown.active {
  display: block;
}

.settings-header {
  padding: 0.5rem 0.75rem;
  font-size: calc(var(--subtitle-font-size) * 0.85);
  font-weight: 600;
  color: var(--text-color-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.settings-option {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  width: 100%;
  padding: 0.75rem;
  background: transparent;
  border: none;
  border-radius: var(--input-border-radius);
  font-size: var(--input-font-size);
  color: var(--text-color-primary);
  cursor: pointer;
  transition: background var(--transition-speed) ease;
  text-align: left;
}

.settings-option:hover {
  background: var(--input-bg);
}

.settings-option span:not(.settings-check) {
  flex: 1;
}

.settings-check {
  font-size: 0.75rem;
  opacity: 0;
  color: var(--text-color-primary);
  font-weight: bold;
  transition: opacity var(--transition-speed) ease;
}

.settings-option.active .settings-check {
  opacity: 1;
}
.settings-divider {
  height: 1px;
  background: var(--input-border);
  margin: 0.5rem 0;
}
.settings-action {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  width: 100%;
  padding: 0.75rem;
  background: transparent;
  border: none;
  border-radius: var(--input-border-radius);
  font-size: var(--input-font-size);
  color: var(--button-primary-bg);
  cursor: pointer;
  transition: all var(--transition-speed) ease;
  text-align: left;
  font-weight: 500;
}

.settings-action:hover {
  background: var(--param-item-bg);
  transform: translateX(2px);
}

.settings-action svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}
.help-dropdown {
  position: fixed;
  background: var(--card-bg, #ffffff);
  border: var(--input-border-width) solid var(--input-border);
  border-radius: var(--card-border-radius);
  box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3), 0 0 0 1px rgba(0,0,0,0.05);
  padding: 0.5rem;
  width: 280px;
  max-width: calc(100vw - 2rem);
  z-index: 1000 !important; /* Maximaler Z-Index erzwingen */
  opacity: 0;
  transform: translateY(-10px);
  pointer-events: none;
  transition: opacity 0.2s ease, transform 0.2s ease;
}

.help-dropdown.active {
  opacity: 1;
  transform: translateY(0);
  pointer-events: all;
}

.help-header {
  padding: 1rem;
  font-size: var(--subtitle-font-size);
  font-weight: 700;
  color: var(--text-color-primary);
  text-transform: none;
  letter-spacing: -0.01em;
  background: linear-gradient(135deg, var(--button-primary-bg) 0%, var(--button-secondary-bg) 100%);
  color: white;
  border-radius: calc(var(--card-border-radius) - 0.5rem) calc(var(--card-border-radius) - 0.5rem) 0 0;
  margin: -0.5rem -0.5rem 0.75rem -0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.help-header::before {
  content: "ðŸ’¡";
  font-size: 1.25em;
  filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
}

.help-content {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.help-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  font-size: var(--input-font-size);
  color: var(--text-color-secondary);
  line-height: 1.4;
  border-radius: calc(var(--card-border-radius) * 0.5);
  transition: background-color 0.15s ease;
}

.help-item:hover {
  background-color: var(--param-item-bg);
}

/* Help Dropdown in Config Panel Header */
.help-dropdown-panel {
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  box-shadow: 0 20px 25px -5px rgba(0,0,0,0.15);
  padding: 0.5rem;
  width: 280px;
  z-index: 1000;
  opacity: 0;
  transform: translateY(-10px);
  pointer-events: none;
  transition: opacity 0.2s ease, transform 0.2s ease;
}

.help-dropdown-panel.active {
  opacity: 1;
  transform: translateY(0);
  pointer-events: all;
}

.help-item svg {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
  color: var(--button-primary-bg);
}



.viewer-model-status {
  position: absolute;
  bottom: 1rem;
  right: 1rem;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(4px);
  padding: var(--badge-padding-y) var(--badge-padding-x);
  border-radius: var(--badge-border-radius);
  box-shadow: var(--card-shadow);
  font-size: var(--badge-font-size);
  color: var(--text-color-secondary);
  display: none;
  align-items: center;
  gap: 0.5rem;
  z-index: 10;
  transition: opacity 0.5s ease;
}

.viewer-model-status.active {
  display: flex;
  animation: fadeInUp 0.3s ease 0.15s both;
}

.viewer-model-status.fade-out {
  opacity: 0;
}

.status-indicator {
  width: 8px;
  height: 8px;
  background: #10b981;
  border-radius: 50%;
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.viewer-info-bar {
  padding: var(--card-padding);
  border-top: 1px solid #f3f4f6;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
}

.info-content {
  flex: 1;
  min-width: 0;
}

.info-label {
  font-size: var(--subtitle-font-size);
  color: var(--text-color-muted);
}

.info-value {
  color: var(--text-color-primary);
  margin-top: 0.25rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-weight: 500;
}

.pending-badge {
  flex-shrink: 0;
  display: none;
  align-items: center;
  gap: 0.5rem;
  padding: calc(var(--badge-padding-y) * 0.75) var(--badge-padding-x);
  background: #fef3c7;
  color: #92400e;
  border-radius: var(--badge-border-radius);
  font-size: calc(var(--badge-font-size) * 0.9);
  font-weight: 500;
}

.pending-badge.active {
  display: inline-flex;
}

.pending-dot {
  width: 8px;
  height: 8px;
  background: var(--button-secondary-bg);
  border-radius: 50%;
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* USP Section Styles */
.viewer-usp-section {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
  background: var(--card-bg);
  border-radius: var(--card-border-radius);
  box-shadow: var(--card-shadow);
  padding: 1.5rem;
}

@media (min-width: 1024px) {
  .viewer-usp-section {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* Hide USP Section on Mobile */
@media (max-width: 1023px) {
  .viewer-usp-section {
    display: none;
  }
}

.usp-item {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  transition: all var(--transition-speed) ease;
  padding: 0.5rem;
  border-radius: calc(var(--card-border-radius) * 0.5);
}

.usp-item:hover {
  background: var(--param-item-bg);
  transform: translateY(-2px);
}

.usp-icon {
  width: 40px;
  height: 40px;
  min-width: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, var(--button-primary-bg) 0%, var(--button-secondary-bg) 100%);
  border-radius: calc(var(--card-border-radius) * 0.5);
  color: white;
}

.usp-icon svg {
  width: 20px;
  height: 20px;
}

.usp-content {
  flex: 1;
}

.usp-title {
  font-size: var(--subtitle-font-size);
  font-weight: 600;
  color: var(--text-color-primary);
  margin-bottom: 0.25rem;
}

.usp-description {
  font-size: calc(var(--subtitle-font-size) * 0.85);
  color: var(--text-color-secondary);
  line-height: 1.4;
}
.mobile-sticky-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: var(--mobile-sticky-bar-height);
  background: var(--card-bg);
  border-top: var(--input-border-width) solid var(--input-border);
  box-shadow: 0 -4px 12px rgba(0,0,0,0.08);
  z-index: 40;
  display: none; /* Hidden - config panel is now fixed */
  align-items: center;
}

/* Hide on Desktop */
@media (min-width: 1024px) {
  .mobile-sticky-bar {
    display: none;
  }
}

.mobile-bar-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 0 1rem;
  gap: 1rem;
}

.mobile-bar-price {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.mobile-price-label {
  font-size: calc(var(--subtitle-font-size) * 0.85);
  color: var(--text-color-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-weight: 600;
}

.mobile-price-value {
  font-size: calc(var(--price-font-size) * 0.7);
  font-weight: var(--price-font-weight);
  color: var(--price-color);
}

.mobile-configure-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: calc(var(--button-primary-padding-y) * 0.7) calc(var(--button-primary-padding-x) * 0.9);
  background: var(--button-primary-bg);
  color: var(--button-primary-text);
  border: none;
  border-radius: var(--button-primary-radius);
  font-size: var(--button-primary-font-size);
  font-weight: 600;
  cursor: pointer;
  box-shadow: var(--card-shadow);
  transition: all var(--transition-speed) ease;
  min-height: 48px;
}

.mobile-configure-btn:active {
  transform: scale(0.98);
}
.mobile-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(4px);
  z-index: 45;
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--transition-speed) ease;
  display: none; /* Hidden in scroll-based mobile layout */
}

.mobile-backdrop.active {
  opacity: 1;
  pointer-events: all;
}

/* Hide on Desktop */
@media (min-width: 1024px) {
  .mobile-backdrop {
    display: none;
  }
}
/* Mobile: Panel in normal flow (scrollable to footer) */
@media (max-width: 1023px) {
.prinjekt-config-wrapper {
    position: relative;
    margin-top: 0;
    min-height: 60vh;
    background: var(--mobile-sheet-bg);
    border-radius: var(--mobile-sheet-radius) var(--mobile-sheet-radius) 0 0;
    box-shadow: 0 -8px 32px rgba(0,0,0,0.15);
    padding: 2.5rem 1.25rem 4rem;
    -webkit-overflow-scrolling: touch;
    overflow: visible;
    z-index: auto ; /* â˜… ALLES INS NEGATIVE â˜… */
  }
  
  .prinjekt-config-wrapper:has(.param-select-dropdown.active) {
    z-index: 100; /* â˜… Springt vor den Viewer (0), aber bleibt unter dem Header */
  }
}

/* Desktop: Normal flow, not fixed */
@media (min-width: 1024px) {
  .prinjekt-config-wrapper {
    position: relative;
    max-height: none;
    transform: none;
    padding: 0;
    background: transparent;
    box-shadow: none;
    border-radius: 0;
    overflow: visible;
  }
}

.mobile-sheet-handle {
  position: fixed;
  top: 0.75rem;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  display: none; /* Hidden - not needed for fixed bottom panel */
  justify-content: center;
  padding: 0.5rem;
  cursor: grab;
  z-index: 51;
}

/* Hide on Desktop */
@media (min-width: 1024px) {
  .mobile-sheet-handle {
    display: none;
  }
}

.sheet-handle-bar {
  width: 40px;
  height: 4px;
  background: var(--mobile-sheet-handle-bg);
  border-radius: 2px;
}
.mobile-close-btn {
  display: none !important; /* Hidden in scroll-based layout */
}

/* Hide on Desktop */
@media (min-width: 1024px) {
  .mobile-close-btn {
    display: none !important;
  }
}
.config-card {
  background: var(--card-bg);
  border-radius: var(--card-border-radius);
  box-shadow: var(--card-shadow);
  padding: var(--card-padding);
  margin-bottom: var(--card-margin-bottom);
  overflow: visible;
}

/* Parameters Card: Extra padding at bottom to prevent overlap with update button */
.params-card {
  padding-bottom: 90px;
  position: relative;
}

.header-row {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 1rem;
  gap: 1rem;
}

.header-content {
  flex: 1;
  min-width: 0;
}

.product-title {
  font-size: var(--title-font-size);
  font-weight: var(--title-font-weight);
  color: var(--text-color-primary);
  margin-bottom: 0.5rem;
  line-height: var(--title-line-height);
}

.product-description {
  color: var(--text-color-secondary);
  font-size: var(--subtitle-font-size);
  font-weight: var(--subtitle-font-weight);
  line-height: 1.5;
}

.header-actions {
  display: flex;
  gap: 0.5rem;
  flex-shrink: 0;
}

.icon-button {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: var(--input-border-width) solid var(--input-border);
  border-radius: var(--input-border-radius);
  background: transparent;
  color: var(--text-color-secondary);
  cursor: pointer;
  transition: all var(--transition-speed) ease;
}

.icon-button:hover {
  background: var(--input-bg);
  color: var(--text-color-primary);
}

.icon-button svg {
  width: 18px;
  height: 18px;
}

.price-row {
  display: flex;
  align-items: baseline;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
}

.price-value {
  font-size: var(--price-font-size);
  font-weight: var(--price-font-weight);
  color: var(--price-color);
}

.price-vat {
  font-size: var(--subtitle-font-size);
  color: var(--text-color-muted);
}

.shipping-row {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  font-size: var(--subtitle-font-size);
  color: var(--text-color-secondary);
  flex-wrap: wrap;
}

.shipping-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.params-heading {
  font-size: calc(var(--title-font-size) * 0.8);
  font-weight: 700;
  color: var(--text-color-primary);
  margin-bottom: 1.5rem;
}

.params-list {
  margin: 0 calc(var(--card-padding) * -1);
  padding: 0 var(--card-padding);
  overflow: visible;
}

/* Desktop: Scrollable parameter list */
@media (min-width: 1024px) {
  .params-list {
    max-height: 400px;
    overflow-y: auto;
  }
}

/* CRITICAL: 40px spacing between parameter items */
.params-list > * {
  margin-bottom: 40px;
}

.params-list > *:last-child {
  margin-bottom: 0;
}
.params-list:focus-within {
  -webkit-mask-image: none;
  mask-image: none;
}

.params-list::-webkit-scrollbar {
  width: 6px;
}

.params-list::-webkit-scrollbar-track {
  background: transparent;
}

.params-list::-webkit-scrollbar-thumb {
  background: var(--input-border);
  border-radius: 3px;
}

.skeleton-loader {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.skeleton-item {
  height: 80px;
  background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
  background-size: 200% 100%;
  border-radius: var(--param-item-radius);
  animation: shimmer 1.5s ease-in-out infinite;
}

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.param-item {
  padding: var(--param-item-padding);
  background: var(--param-item-bg);
  border: var(--input-border-width) solid transparent; 
  box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 4px 8px rgba(0,0,0,0.04);
  border-radius: var(--param-item-radius);
  margin-bottom: var(--param-item-margin-bottom);
  transition: border-color var(--transition-speed) ease, box-shadow 0.2s ease;
  position: relative;
  overflow: visible;
}

.param-item:hover {
  border-color: var(--input-border);
  z-index: 10;
}

.param-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 0.75rem;
  gap: 0.5rem;
}

.param-label {
  color: var(--text-color-primary);
  font-weight: 500;
  font-size: var(--input-font-size);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.param-value-input {
  width: 80px;
  padding: var(--input-padding-y) var(--input-padding-x);
  border: var(--input-border-width) solid var(--input-border);
  border-radius: var(--input-border-radius);
  background: var(--card-bg);
  text-align: right;
  font-size: var(--input-font-size);
  color: var(--text-color-primary);
  font-family: inherit;
}

.param-value-input:focus {
  outline: none;
  border-color: var(--button-secondary-bg);
  box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
}

.param-slider {
  -webkit-appearance: none;
  width: 100%;
  height: var(--slider-height);
  background: var(--slider-track-color);
  border-radius: 999px;
  outline: none;
  margin: 0.75rem 0;
  cursor: pointer;
}
.param-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: var(--slider-thumb-size-mobile);
  height: var(--slider-thumb-size-mobile);
  background: var(--slider-thumb-color);
  border: 3px solid var(--card-bg);
  border-radius: 50%;
  cursor: grab;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.param-slider::-webkit-slider-thumb:active {
  cursor: grabbing;
}

.param-slider::-moz-range-thumb {
  width: var(--slider-thumb-size-mobile);
  height: var(--slider-thumb-size-mobile);
  background: var(--slider-thumb-color);
  border: 3px solid var(--card-bg);
  border-radius: 50%;
  cursor: grab;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.param-range {
  display: flex;
  justify-content: space-between;
  font-size: calc(var(--input-font-size) * 0.85);
  color: var(--text-color-muted);
}
.param-tooltip {
  display: inline-flex;
  align-items: center;
  cursor: help;
  margin-left: 0.25rem;
  position: relative;
}

.param-tooltip:hover i {
  color: var(--button-secondary-bg) !important;
}

.param-tooltip::before {
  content: attr(data-tooltip);
  position: absolute;
  left: calc(100% + 12px);
  top: 50%;
  transform: translateY(-50%) translateX(-4px);
  background: rgba(17, 24, 39, 0.95);
  color: white;
  padding: 0.5rem 0.75rem;
  border-radius: 8px;
  font-size: 0.875rem;
  line-height: 1.4;
  white-space: normal;
  max-width: 240px;
  min-width: 120px;
  width: max-content;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease, transform 0.2s ease;
  z-index: 10000;
  text-align: left;
}
.param-tooltip::after {
  content: '';
  position: absolute;
  left: calc(100% + 6px);
  top: 50%;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  border-right: 6px solid rgba(17, 24, 39, 0.95);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
  z-index: 10000;
}

.param-tooltip:hover::before,
.param-tooltip:hover::after {
  opacity: 1;
}

.param-tooltip:hover::before {
  transform: translateY(-50%) translateX(0);
}
.param-tooltip:active::before,
.param-tooltip:active::after,
.param-tooltip.tooltip-active::before,
.param-tooltip.tooltip-active::after {
  opacity: 1;
}

.param-tooltip.tooltip-active::before {
  transform: translateY(-50%) translateX(0);
}
@media (max-width: 768px) {
  .param-tooltip::before {
    max-width: 200px;
    font-size: 0.8125rem;
  }
}
.param-custom-select {
  position: relative;
  width: 100%;
  overflow: visible;
}

.param-select-trigger {
  width: 100%;
  padding: var(--input-padding-y) var(--input-padding-x);
  border: var(--input-border-width) solid var(--input-border);
  border-radius: var(--input-border-radius);
  background: var(--card-bg); /* Heller als der Item-Hintergrund */
  font-size: var(--input-font-size);
  color: var(--text-color-primary);
  font-family: inherit; /* â˜… FIX: Schriftart erben */
  cursor: pointer;
  transition: all var(--transition-speed) ease;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
  text-align: left;
  /* â˜… NEU: Subtiler Schatten statt harter Kante */
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.param-select-trigger:hover {
  border-color: var(--button-secondary-bg); /* Akzentfarbe bei Hover */
  box-shadow: 0 0 0 1px var(--button-secondary-bg); /* Leichter Ring */
}

.param-select-trigger.active {
  border-color: var(--button-secondary-bg);
  /* â˜… NEU: Weicherer Fokus-Ring */
  box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2); 
  z-index: 10002;
}

.param-select-arrow {
  width: 16px;
  height: 16px;
  color: var(--text-color-muted);
  transition: transform var(--transition-speed) ease;
  flex-shrink: 0;
}

.param-select-trigger.active .param-select-arrow {
  transform: rotate(180deg);
}

.param-select-dropdown {
  position: fixed !important;
  background: var(--card-bg, #ffffff) !important;
  border: 2px solid var(--button-secondary-bg);
  border-radius: var(--input-border-radius);
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.05);
  max-height: 280px;
  overflow-y: auto;
  overflow-x: hidden;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transform: translateY(-8px);
  transition: opacity 0.2s ease, transform 0.2s ease, visibility 0s 0.2s;
  z-index: 10001 !important;
  min-width: 150px;
  touch-action: auto;
}

.param-select-dropdown.active {
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
  transform: translateY(0);
  transition: opacity 0.2s ease, transform 0.2s ease, visibility 0s;
}

.param-select-dropdown {
  position: absolute !important; /* WICHTIG: Ã„ndern auf absolute */
  top: calc(100% + 4px); /* Position direkt unter dem Button */
  left: 0;
  width: 100%;
  background: var(--card-bg, #ffffff) !important;
  border: 2px solid var(--button-secondary-bg);
  border-radius: var(--input-border-radius);
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.05);
  max-height: 280px;
  overflow-y: auto;
  overflow-x: hidden;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transform: translateY(-8px);
  transition: opacity 0.2s ease, transform 0.2s ease, visibility 0s 0.2s;
  z-index: 10001 !important; /* Hoch genug fÃ¼r den Container, aber nicht 'fixed' */
  min-width: 150px;
  touch-action: auto;
}
.param-select-option {
  padding: var(--input-padding-y) var(--input-padding-x);
  cursor: pointer;
  transition: background var(--transition-speed) ease, color 0.1s ease;
  color: var(--text-color-primary);
  font-size: var(--input-font-size);
  font-family: inherit; /* â˜… FIX: Schriftart erben */
  touch-action: auto;
  /* â˜… NEU: Weichere Ecken fÃ¼r die Optionen */
  border-radius: 6px; 
  margin: 4px; /* Abstand im MenÃ¼ */
}

.param-select-option:hover {
  background: var(--input-bg);
  color: var(--text-color-primary);
}

.param-select-option.selected {
  /* â˜… NEU: Weichere Hervorhebung */
  background: rgba(245, 158, 11, 0.1); /* (f59e0b als Akzentfarbe angenommen) */
  color: var(--button-primary-bg);
  font-weight: 600;
}
.param-select-dropdown::-webkit-scrollbar {
  width: 6px;
}

.param-select-dropdown::-webkit-scrollbar-track {
  background: transparent;
}

.param-select-dropdown::-webkit-scrollbar-thumb {
  background: #d1d5db;
  border-radius: 3px;
}

.param-select-dropdown::-webkit-scrollbar-thumb:hover {
  background: #9ca3af;
}
.param-item-checkbox {
  display: flex;
  align-items: center;
  padding: 1rem var(--param-item-padding);
}

.param-checkbox-label {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  cursor: pointer;
  width: 100%;
}

.param-checkbox {
  width: 20px;
  height: 20px;
  border: 2px solid var(--input-border);
  border-radius: 4px;
  cursor: pointer;
  flex-shrink: 0;
  accent-color: var(--button-secondary-bg);
}

.param-checkbox-text {
  color: var(--text-color-primary);
  font-weight: 500;
  font-size: var(--input-font-size);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.param-text-input {
  width: 100%;
  padding: var(--input-padding-y) var(--input-padding-x);
  border: var(--input-border-width) solid var(--input-border);
  border-radius: var(--input-border-radius);
  background: var(--card-bg);
  font-size: var(--input-font-size);
  color: var(--text-color-primary);
  font-family: inherit;
  transition: border-color var(--transition-speed) ease;
}

.param-text-input:focus {
  outline: none;
  border-color: var(--button-secondary-bg);
  box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
}
.param-textarea {
  width: 100%;
  padding: var(--input-padding-y) var(--input-padding-x);
  border: var(--input-border-width) solid var(--input-border);
  border-radius: var(--input-border-radius);
  background: var(--card-bg);
  font-size: var(--input-font-size);
  color: var(--text-color-primary);
  font-family: inherit;
  resize: vertical;
  transition: border-color var(--transition-speed) ease;
}
.param-value-input,
.param-text-input,
.param-textarea {
  font-family: inherit; /* â˜… FIX: Schriftart erben */
}

.param-textarea:focus {
  outline: none;
  border-color: var(--button-secondary-bg);
  box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
}

.cta-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1rem;
  gap: 1rem;
}

.cta-label {
  font-size: var(--subtitle-font-size);
  color: var(--text-color-muted);
}

.cta-value {
  color: var(--text-color-primary);
  margin-top: 0.25rem;
  font-weight: 600;
  font-size: var(--input-font-size);
}

.cta-delivery {
  text-align: right;
}

.add-to-cart-btn {
  width: 100%;
  padding: var(--button-primary-padding-y) var(--button-primary-padding-x);
  background: var(--button-primary-bg);
  color: var(--button-primary-text);
  border: none;
  border-radius: var(--button-primary-radius);
  font-size: var(--button-primary-font-size);
  font-weight: 600;
  cursor: pointer;
  box-shadow: var(--card-shadow);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  transition: all var(--transition-speed) ease;
  min-height: 56px;
}

.add-to-cart-btn:active:not(:disabled) {
  transform: scale(0.98);
}

.add-to-cart-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.cart-warning {
  text-align: center;
  font-size: var(--subtitle-font-size);
  color: var(--button-secondary-bg);
  margin-top: 0.75rem;
  font-weight: 500;
  display: none;
}

.cart-warning.active {
  display: block;
}

.toast-notification {
  position: fixed;
  bottom: calc(var(--mobile-sticky-bar-height) + 1rem);
  right: 1rem;
  left: 1rem;
  background: var(--card-bg);
  border: var(--input-border-width) solid var(--input-border);
  border-radius: var(--card-border-radius);
  padding: 1rem;
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  display: none;
  z-index: 9999;
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.toast-notification.active {
  display: block;
}

.toast-notification.error {
  border-color: #fee2e2;
  background: #fef2f2;
  color: #991b1b;
}

.toast-notification.success {
  border-color: #dcfce7;
  background: #f0fdf4;
  color: #065f46;
}

.fullscreen-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  z-index: 10000;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 0;
}

.fullscreen-overlay.active {
  display: flex;
}

.fullscreen-reset-btn {
  position: fixed;
  top: 1rem;
  left: 1rem;
  width: 56px;
  height: 56px;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(4px);
  border: 1px solid #e5e7eb;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  color: var(--text-color-primary);
  transition: all 0.2s ease;
  z-index: 10001;
}

.fullscreen-reset-btn:hover {
  background: white;
  transform: scale(1.1);
}

.fullscreen-reset-btn svg {
  width: 24px;
  height: 24px;
}

.fullscreen-close-btn {
  position: fixed;
  top: 1rem;
  right: 1rem;
  width: 56px;
  height: 56px;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(4px);
  border: 1px solid #e5e7eb;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  color: var(--text-color-primary);
  transition: all 0.2s ease;
  z-index: 10001;
}

.fullscreen-close-btn:hover {
  background: white;
  transform: scale(1.1);
}

.fullscreen-close-btn svg {
  width: 28px;
  height: 28px;
}

.fullscreen-viewer {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.fullscreen-overlay canvas {
  width: 100% !important;  /* FÃ¼lle den .fullscreen-viewer Container */
  height: 100% !important; /* FÃ¼lle den .fullscreen-viewer Container */
  object-fit: unset;      /* Entferne das 'contain', das die RÃ¤nder verursacht */
}

@media (max-width: 1023px) {
  .prinjekt-config-wrapper.active .update-btn-wrapper.active {
    position: fixed;
    top: 20vh;
    left: 1rem;
    right: 1rem;
    width: calc(100% - 2rem);
    margin: 0;
    z-index: 100;
    background: transparent;
    padding: 0;
  }
  
  .prinjekt-config-wrapper.active .update-preview-btn {
    max-width: none;
    box-shadow: 0 12px 24px -8px rgba(245, 158, 11, 0.5), 0 4px 8px rgba(0, 0, 0, 0.15);
  }
}

@media (min-width: 1024px) {
  .prinjekt-app {
    padding: var(--container-padding);
  }

  .prinjekt-container {
    max-width: var(--container-max-width);
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--column-gap);
    align-items: start;
    min-height: auto;
  }

  .prinjekt-viewer-wrapper {
    position: sticky;
    top: 2rem;
    padding: 0;
    padding-bottom: 0;
    z-index: 50;
  }

  .viewer-display {
    aspect-ratio: var(--viewer-aspect-ratio);
  }
  .mobile-sticky-bar {
    display: none;
  }

  .mobile-backdrop {
    display: none;
  }

  .mobile-sheet-handle {
    display: none;
  }

  .mobile-close-btn {
    display: none !important;
  }
  .prinjekt-config-wrapper {
    position: relative;
    transform: none;
    height: auto;
    background: transparent;
    border-radius: 0;
    box-shadow: none;
    padding: 0;
    overflow: visible;
    z-index: 100;
  }
  .param-slider::-webkit-slider-thumb {
    width: var(--slider-thumb-size);
    height: var(--slider-thumb-size);
  }

  .param-slider::-moz-range-thumb {
    width: var(--slider-thumb-size);
    height: var(--slider-thumb-size);
  }

  .params-list {
    max-height: 500px;
  }

  .settings-btn,
  .reset-button {
    min-height: auto;
    width: 40px;
    height: 40px;
  }
  .update-btn-wrapper {
    position: static;
    margin-top: 1.5rem;
    padding: 0;
    background: transparent;
  }
  
  .update-preview-btn {
    max-width: none;
  }
  
  .update-preview-btn,
  .add-to-cart-btn {
    min-height: 48px;
  }

  .cta-card {
    position: sticky;
    bottom: 0;
    min-height: 2px;
    padding: 20px;
  }

  .toast-notification {
    bottom: 1.5rem;
    right: 1.5rem;
    left: auto;
    min-width: 300px;
    width: auto;
  }

  .help-dropdown,
  .settings-dropdown {
    z-index: 10000 !important;
  }
}
@media (max-width: 640px) {
  .config-card {
    padding: calc(var(--card-padding) * 0.75);
  }

  .product-title {
    font-size: calc(var(--title-font-size) * 0.85);
  }

  .header-row {
    flex-direction: column;
  }

  .reset-button {
    align-self: flex-start;
  }

  .shipping-row {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.75rem;
  }

  .cta-row {
    flex-direction: column;
    align-items: flex-start;
  }

  .cta-delivery {
    text-align: left;
  }
  .canvas-update-btn {
    padding: 0.875rem 1.5rem;
    font-size: calc(var(--button-primary-font-size) * 0.9);
  }
  
  .canvas-update-btn svg {
    width: 18px;
    height: 18px;
  }
  
  .help-dropdown {
    max-height: 70vh;
    overflow-y: auto;
  }
  
  .help-content {
    gap: 0.25rem;
  }
  
  .help-item {
    padding: 0.625rem;
    font-size: calc(var(--input-font-size) * 0.9);
  }
  
  .help-item svg {
    width: 18px;
    height: 18px;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  (function() {
    'use strict';
    
    const sid = '{{ section.id }}';
    const LABELS = {
      saveConfig: '{{ section.settings.settings_save_config_label | default: "Save Configuration" }}',
      loadConfig: '{{ section.settings.settings_load_config_label | default: "Load Configuration" }}'
    };
    const canvas = document.getElementById(`canvas-${sid}`);
    const placeholder = document.getElementById(`placeholder-${sid}`);
    const loading = document.getElementById(`loading-${sid}`);
    const loadingText = document.getElementById(`loading-text-${sid}`);
    const modelStatus = document.getElementById(`model-status-${sid}`);
    const configSummary = document.getElementById(`config-summary-${sid}`);
    const pendingBadge = document.getElementById(`pending-badge-${sid}`);
    // priceMain removed - price only in CTA card now
    const priceFooter = document.getElementById(`price-footer-${sid}`);
    const mobilePrice = document.getElementById(`mobile-price-${sid}`);
    const paramsContainer = document.getElementById(`params-container-${sid}`);
    const resetBtn = document.getElementById(`reset-btn-${sid}`);
    const cartBtn = document.getElementById(`cart-btn-${sid}`);
    const cartWarning = document.getElementById(`cart-warning-${sid}`);
    const settingsBtn = document.getElementById(`settings-btn-${sid}`);
    const settingsMenu = document.getElementById(`settings-menu-${sid}`);
    const helpBtn = document.getElementById(`help-btn-${sid}`);
    const helpMenu = document.getElementById(`help-menu-${sid}`);
    if (settingsMenu) document.body.appendChild(settingsMenu);
    if (helpMenu) document.body.appendChild(helpMenu);
    const toast = document.getElementById(`toast-${sid}`);
    const canvasUpdateBtnWrapper = document.getElementById(`canvas-update-btn-${sid}`);
    const canvasUpdateBtn = canvasUpdateBtnWrapper?.querySelector('.canvas-update-btn');
    const configPanel = document.getElementById(`config-panel-${sid}`);
    const mobileConfigureBtn = document.getElementById(`mobile-configure-btn-${sid}`);
    const mobileCloseBtn = document.getElementById(`mobile-close-btn-${sid}`);
    const mobileBackdrop = document.getElementById(`mobile-backdrop-${sid}`);
    const sheetHandle = configPanel?.querySelector('.mobile-sheet-handle');
    const fullscreenBtn = document.getElementById(`fullscreen-btn-${sid}`);
    const fullscreenOverlay = document.getElementById(`fullscreen-overlay-${sid}`);
    const fullscreenCloseBtn = document.getElementById(`fullscreen-close-${sid}`);
    const fullscreenResetBtn = document.getElementById(`fullscreen-reset-view-${sid}`);
    const resetViewBtn = document.getElementById(`reset-view-btn-${sid}`);
    
    let configurator;
    let currentParams = {};
    let viewerSettings = {
      grid: {{ show_grid }},
      axes: {{ show_axes }},
      autoRotate: {{ auto_rotate }},
      wireframe: false
    };
    let isDragging = false;
    let startY = 0;
    let currentTranslate = 0;
    function openSheet() {
      if (!configPanel || window.innerWidth >= 1024) return;
      configPanel.classList.add('active');
      // No backdrop or transforms needed for scroll-based layout
    }
    
    function closeSheet() {
      if (!configPanel) return;
      configPanel.classList.remove('active');
    }
function openFullscreen() {
      if (!fullscreenOverlay) return;
      // Browser Fullscreen API aktivieren
      const elem = fullscreenOverlay;
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.webkitRequestFullscreen) { /* Safari */
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) { /* IE11 */
        elem.msRequestFullscreen();
      }
      
      fullscreenOverlay.classList.add('active');
      document.body.style.overflow = 'hidden';
      const currentParent = canvas.parentElement;
      const fullscreenViewer = fullscreenOverlay.querySelector('.fullscreen-viewer');
      
      if (fullscreenViewer && currentParent) {
        canvas.dataset.originalParent = currentParent.className;
        fullscreenViewer.appendChild(canvas);
      }
      
      refreshIcons();

      // NEU: Warte kurz, bis der Browser die GrÃ¶ÃŸe angepasst hat,
      // und rufe dann die Resize-Funktion der Master-Logic auf.
      setTimeout(() => {
        if (configurator && typeof configurator.handleResize === 'function') {
          console.log('Fullscreen entered, resizing canvas...');
          configurator.handleResize();
        }
      }, 10); // 10ms Puffer
    }
    
function closeFullscreen() {
      if (!fullscreenOverlay) return;
      // Browser Fullscreen beenden
      if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) { /* Safari */
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) { /* IE11 */
          document.msExitFullscreen();
        }
      }
      
      fullscreenOverlay.classList.remove('active');
      document.body.style.overflow = '';
      const viewerDisplay = document.querySelector(`#prinjekt-root-${sid} .viewer-display`);
      if (viewerDisplay && canvas.parentElement !== viewerDisplay) {
        // WICHTIG: Setze Inline-Stile zurÃ¼ck, damit CSS wieder greift
        canvas.style.width = '';
        canvas.style.height = '';
        viewerDisplay.appendChild(canvas);
      }
      
      refreshIcons();

      // FEHLENDER TEIL: Resize beim SchlieÃŸen aufrufen
      setTimeout(() => {
        if (configurator && typeof configurator.handleResize === 'function') {
          console.log('Fullscreen exited, resizing canvas back...');
          configurator.handleResize();
        }
      }, 10); // 10ms Puffer
    }
    
    function resetView() {
      if (!configurator) return;
      
      // Kamera zur Standard-Ansicht zurÃ¼cksetzen
      try {
        if (configurator.resetCamera && typeof configurator.resetCamera === 'function') {
          configurator.resetCamera();
        } else if (configurator.viewer && configurator.viewer.resetCamera) {
          configurator.viewer.resetCamera();
        } else if (configurator.controls && configurator.controls.reset) {
          configurator.controls.reset();
        }
        showToast('Ansicht zurÃ¼ckgesetzt âœ“', 'success');
      } catch (error) {
        console.warn('Reset camera not available:', error);
        // Fallback: Model neu generieren
        if (configurator.generateModel) {
          configurator.generateModel().then(() => {
            showToast('Ansicht zurÃ¼ckgesetzt âœ“', 'success');
          });
        }
      }
    }

    // Hilfsfunktion: Dropdown neu positionieren
    function repositionDropdown(dropdown, trigger) {
      if (!dropdown || !trigger || !dropdown.classList.contains('active')) return;
      const rect = trigger.getBoundingClientRect();
      dropdown.style.top = `${rect.bottom + window.scrollY + 4}px`;
      dropdown.style.left = `${rect.left + window.scrollX}px`;
      dropdown.style.width = `${rect.width}px`;
    }
    
    function handleDragStart(e) {
      if (window.innerWidth >= 1024) return;
      isDragging = true;
      startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
      configPanel.style.transition = 'none';
    }
    
    function handleDragMove(e) {
      if (!isDragging || window.innerWidth >= 1024) return;
      const currentY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
      const deltaY = currentY - startY;
      if (deltaY > 0) {
        currentTranslate = deltaY;
        configPanel.style.transform = `translateY(${deltaY}px)`;
      }
    }
    
    function handleDragEnd() {
      if (!isDragging || window.innerWidth >= 1024) return;
      isDragging = false;
      configPanel.style.transition = '';
      if (currentTranslate > 100) {
        closeSheet();
      } else {
        configPanel.style.transform = 'translateY(0)';
      }
      currentTranslate = 0;
    }
    function refreshIcons() {
      if (window.feather && typeof window.feather.replace === 'function') {
        requestAnimationFrame(() => window.feather.replace());
      }
      setupTooltips();
    }
    
    function setupTooltips() {
      const tooltips = paramsContainer.querySelectorAll('.param-tooltip');
      
      tooltips.forEach(tooltip => {
        tooltip.replaceWith(tooltip.cloneNode(true));
      });
      paramsContainer.querySelectorAll('.param-tooltip').forEach(tooltip => {
        tooltip.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          paramsContainer.querySelectorAll('.param-tooltip').forEach(t => {
            if (t !== tooltip) t.classList.remove('tooltip-active');
          });
          tooltip.classList.toggle('tooltip-active');
          if (tooltip.classList.contains('tooltip-active')) {
            setTimeout(() => {
              tooltip.classList.remove('tooltip-active');
            }, 3000);
          }
        });
      });
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.param-tooltip')) {
          paramsContainer.querySelectorAll('.param-tooltip').forEach(t => {
            t.classList.remove('tooltip-active');
          });
        }
      }, { passive: true });
    }
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.param-select-trigger') && !e.target.closest('.param-select-dropdown')) {
        document.querySelectorAll('.param-select-dropdown.active').forEach(dropdown => {
          dropdown.classList.remove('active');
        });
        document.querySelectorAll('.param-select-trigger.active').forEach(trigger => {
          trigger.classList.remove('active');
        });
      }
    }, { passive: true });
    // Hilfsfunktion fÃ¼r Positionierung
    function repositionDropdown(dropdown, trigger) {
      if (!dropdown || !trigger || !dropdown.classList.contains('active')) return;
      const rect = trigger.getBoundingClientRect();
      dropdown.style.top = `${rect.bottom + window.scrollY + 4}px`;
      dropdown.style.left = `${rect.left + window.scrollX}px`;
      dropdown.style.width = `${rect.width}px`;
    }

    // Zentraler Scroll-Handler
    const handleScroll = () => {
        const activeDropdown = document.querySelector('.param-select-dropdown.active');
        const activeTrigger = document.querySelector('.param-select-trigger.active');
        if (activeDropdown && activeTrigger) {
          repositionDropdown(activeDropdown, activeTrigger);
        }
    };
    
    // Listener registrieren
    window.addEventListener('scroll', handleScroll, { passive: true });
    window.addEventListener('resize', handleScroll, { passive: true });
    if (paramsContainer) paramsContainer.addEventListener('scroll', handleScroll, { passive: true });
    
    function showToast(message, type = 'info') {
      toast.textContent = message;
      toast.className = `toast-notification active ${type}`;
      setTimeout(() => toast.classList.remove('active'), 3000);
    }

    function updateSettingsUI() {
      Object.entries(viewerSettings).forEach(([key, value]) => {
        const option = settingsMenu.querySelector(`[data-setting="${key}"]`);
        if (option) option.classList.toggle('active', value);
      });
    }

    async function init() {
      try {
        if (typeof window.PrinjektConfigurator === 'undefined') {
          throw new Error('PrinjektConfigurator not loaded');
        }
        
        configurator = new window.PrinjektConfigurator({
          apiBase: '{{ api_base }}',
          productGid: 'gid://shopify/Product/{{ product.id }}',
          canvas: canvas,
          currencyCode: '{{ cart.currency.iso_code }}',
          onStateChange: handleStateChange,
          onError: handleError,
          viewerSettings: {
            grid: viewerSettings.grid,
            axes: viewerSettings.axes,
            shadows: {{ show_shadows }},
            wireframe: viewerSettings.wireframe,
            autoRotate: viewerSettings.autoRotate,
            backgroundColor: '{{ viewer_bg }}',
            modelColor: '{{ section.settings.model_color }}' /* â˜… HIER HINZUFÃœGEN â˜… */
          }
        });
        
        loading.classList.add('active');
        await configurator.initialize();
        await configurator.generateModel();
        
        setupEventListeners();
        updateSettingsUI();
        refreshIcons();
        
      } catch (error) {
        handleError(error);
      }
    }
    function setupEventListeners() {
      canvasUpdateBtn?.addEventListener('click', async () => {
        try {
          canvasUpdateBtn.classList.add('loading');
          await configurator.generateModel();
          canvasUpdateBtn.classList.remove('loading');
        } catch (e) {
          canvasUpdateBtn.classList.remove('loading');
          handleError(e);
        }
      });
      cartBtn.addEventListener('click', async () => {
        try {
          showToast('Adding to cart...', 'success');
          await configurator.addToCart();
          showToast('Added to cart!', 'success');
        } catch (e) {
          handleError(e);
        }
      });
      resetBtn.addEventListener('click', () => {
        if (confirm('Reset all parameters?')) {
          configurator.resetParameters();
        }
      });
      settingsBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        helpMenu?.classList.remove('active');
        settingsMenu.classList.toggle('active');
        if (settingsMenu.classList.contains('active')) {
          const rect = settingsBtn.getBoundingClientRect();
          // Positionierung fÃ¼r das *neue* einheitliche MenÃ¼
          const isMobile = window.innerWidth < 1024;
          if (isMobile) {
              // Auf MobilgerÃ¤ten: Oben rechts positionieren
              settingsMenu.style.top = `${rect.bottom + 8}px`;
              settingsMenu.style.right = '1rem';
              settingsMenu.style.left = 'auto';
              settingsMenu.style.bottom = 'auto';
          } else {
              // Auf Desktop: Oben rechts positionieren
              settingsMenu.style.top = `${rect.bottom + 8}px`;
              settingsMenu.style.right = `${window.innerWidth - rect.right}px`;
              settingsMenu.style.left = 'auto';
              settingsMenu.style.bottom = 'auto';
          }
        }
      });

      // HINWEIS: Der helpBtn-Listener ist jetzt Ã¼berflÃ¼ssig, da Hilfe im Settings-MenÃ¼ integriert ist.
      // Du kannst den 'helpBtn?.addEventListener' Block lÃ¶schen, falls 'helpBtn' nicht mehr existiert.
      // Falls 'helpBtn' noch existiert und ein separates MenÃ¼ Ã¶ffnet:
      helpBtn?.addEventListener('click', (e) => {
        e.stopPropagation();
        settingsMenu?.classList.remove('active');
        helpMenu.classList.toggle('active');
        if (helpMenu.classList.contains('active')) {
          const rect = helpBtn.getBoundingClientRect();
          const isMobile = window.innerWidth < 1024;
          if (isMobile) {
            const spaceBelow = window.innerHeight - rect.bottom;
            if (spaceBelow < 300) {
              helpMenu.style.bottom = `${window.innerHeight - rect.top + 8}px`;
              helpMenu.style.top = 'auto';
            } else {
              helpMenu.style.top = `${rect.bottom + 8}px`;
              helpMenu.style.bottom = 'auto';
            }
            helpMenu.style.left = '1rem';
            helpMenu.style.right = '1rem';
            helpMenu.style.width = 'auto';
          } else {
            helpMenu.style.top = `${rect.bottom + 8}px`;
            helpMenu.style.right = `${window.innerWidth - rect.right}px`;
            helpMenu.style.left = 'auto';
            helpMenu.style.bottom = 'auto';
            helpMenu.style.width = '280px';
          }
          if (typeof feather !== 'undefined') {
            setTimeout(() => feather.replace(), 50);
          }
        }
      });
      
      document.addEventListener('click', () => {
        settingsMenu.classList.remove('active');
        helpMenu?.classList.remove('active');
      });
      helpMenu?.addEventListener('click', (e) => {
        e.stopPropagation();
      });

      // â˜…â˜…â˜… HIER IST DIE KORREKTUR â˜…â˜…â˜…
      settingsMenu.addEventListener('click', (e) => {
        e.stopPropagation(); // Verhindert, dass der Klick das MenÃ¼ schlieÃŸt

        const option = e.target.closest('.settings-option');
        if (option) {
          const setting = option.dataset.setting;
          if (viewerSettings.hasOwnProperty(setting)) {
             viewerSettings[setting] = !viewerSettings[setting];
             configurator.updateViewerSetting(setting, viewerSettings[setting]);
             updateSettingsUI();
          }
          return;
        }
        
        const action = e.target.closest('.settings-action');
        if (action) {
          const actionType = action.id || action.dataset.action; // ID fÃ¼r Reset-Button
          
          if (actionType === 'reset-view-btn-{{ section.id }}') {
            resetView();
            settingsMenu.classList.remove('active');
            return;
          }

          if (actionType === 'save-config-btn-{{ section.id }}' || actionType === 'save-config') {
            const currentConfig = configurator.getCurrentConfig ? configurator.getCurrentConfig() : { parameters: {} };
            const configData = {
              parameters: currentConfig.parameters,
              timestamp: new Date().toISOString(),
              modelUrl: currentConfig.modelUrl,
              version: '1.0'
            };
            const jsonString = JSON.stringify(configData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const downloadUrl = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = downloadUrl;
            const date = new Date().toISOString().split('T')[0];
            const time = new Date().toTimeString().split(' ')[0].replace(/:/g, '-');
            link.download = `prinjekt-config-${date}_${time}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(downloadUrl);
            showToast('Configuration downloaded! ðŸ’¾', 'success');
            settingsMenu.classList.remove('active');
            
          } else if (actionType === 'load-config-btn-{{ section.id }}' || actionType === 'load-config') {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.json';
            
            fileInput.addEventListener('change', (event) => {
              const file = event.target.files[0];
              if (!file) return;
              const reader = new FileReader();
              reader.onload = (e) => {
                try {
                  const configData = JSON.parse(e.target.result);
                  if (!configData.parameters) {
                    showToast('Invalid configuration file', 'error');
                    return;
                  }
                  if (configurator.loadConfiguration) {
                    configurator.loadConfiguration(configData.parameters);
                    showToast('Configuration loaded successfully! âœ…', 'success');
                  }
                  settingsMenu.classList.remove('active');
                  
                } catch (error) {
                  showToast('Failed to load configuration', 'error');
                }
              };
              
              reader.onerror = () => {
                showToast('Failed to read file', 'error');
              };
              
              reader.readAsText(file);
            });
            fileInput.click();
          }
        }
      });
      // â˜…â˜…â˜… ENDE DER KORREKTUR â˜…â˜…â˜…

      resetViewBtn?.addEventListener('click', resetView);
      fullscreenResetBtn?.addEventListener('click', resetView);
      fullscreenBtn?.addEventListener('click', openFullscreen);
      fullscreenCloseBtn?.addEventListener('click', closeFullscreen);
      fullscreenOverlay?.addEventListener('click', (e) => {
        if (e.target === fullscreenOverlay) closeFullscreen();
      });
      
      // Fullscreen Exit Event (ESC-Taste oder Browser-Fullscreen-Beenden)
      const handleFullscreenChange = () => {
        // PrÃ¼ft, ob der Vollbildmodus (browser-native) beendet wurde
        if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
          // Nur wenn unser Overlay noch aktiv ist (d.h. der User hat ESC gedrÃ¼ckt)
          if (fullscreenOverlay?.classList.contains('active')) {
            closeFullscreen(); // Ruft unsere Funktion auf, um den Canvas zurÃ¼ckzusetzen
          }
        }
        // PrÃ¼ft, ob der Vollbildmodus (browser-native) gestartet wurde
        else {
            // Passt die GrÃ¶ÃŸe an, sobald der Modus aktiv ist
            setTimeout(() => {
                if (configurator && typeof configurator.handleResize === 'function') {
                    console.log('Fullscreen state changed, resizing canvas...');
                    configurator.handleResize();
                }
            }, 150);
        }
      };

      document.addEventListener('fullscreenchange', handleFullscreenChange);
      document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
      
      window.addEventListener('resize', () => {
        if (window.innerWidth >= 1024) {
          closeSheet();
        }
      });
      // Panel ist jetzt immer sichtbar im scroll-basierten Layout
      if (window.innerWidth < 1024) {
        configPanel.classList.add('active'); // Mark as active but no transform
      }
    }
    
    function handleStateChange(state) {
      const isLoading = state.loading && !state.initialized;
      loading.classList.toggle('active', isLoading);
      
      const modelLoaded = state.modelLoaded && !state.loading;
      placeholder.style.display = modelLoaded ? 'none' : 'flex';
      canvas.classList.toggle('blurred', state.isDirty && modelLoaded);
      const price = state.pricing?.total?.toFixed(2) || '{{ default_price }}';
      const priceFormatted = `â‚¬${price}`;
      
      if (priceFooter) priceFooter.textContent = priceFormatted;
      if (modelLoaded && !modelStatus.classList.contains('active')) {
        modelStatus.classList.add('active');
        modelStatus.classList.remove('fade-out');
        setTimeout(() => {
          modelStatus.classList.add('fade-out');
          setTimeout(() => {
            modelStatus.classList.remove('active');
          }, 500);
        }, 3000);
      }
      pendingBadge?.classList.toggle('active', state.isDirty);
      cartWarning.classList.toggle('active', state.isDirty);
      canvasUpdateBtnWrapper?.classList.toggle('active', state.isDirty && modelLoaded);
      cartBtn.disabled = state.loading || state.isDirty || !modelLoaded;
      if (state.parameters && configSummary) {
        const summary = Object.values(state.parameters)
          .slice(0, 3)
          .map(p => `${p.label}: ${p.value}${p.unit || ''}`)
          .join(' â€¢ ');
        configSummary.textContent = summary || 'Configuring...';
      }
      if (state.parameters && JSON.stringify(state.parameters) !== JSON.stringify(currentParams)) {
        renderParameters(state.parameters);
        currentParams = JSON.parse(JSON.stringify(state.parameters));
      }
      
      refreshIcons();
    }
    
function renderParameters(parameters) {
      // WICHTIG: Alte Dropdowns, die direkt am body hÃ¤ngen, mÃ¼ssen entfernt werden!
      document.querySelectorAll('.param-select-dropdown').forEach(d => d.remove());
      paramsContainer.innerHTML = '';

      Object.entries(parameters).forEach(([name, param]) => {
        const value = param.value !== undefined ? param.value : param.defaultValue;
        // Normalisiere den Widget-Typ
        const widgetType = (param.widgetType || param.type || 'spinbox').toLowerCase();
        const label = param.label || name;
        const description = param.description || param.tooltip || param.help || '';
        const tooltipIcon = description ? `
          <span class="param-tooltip" data-tooltip="${escapeHtml(description)}">
            <i data-feather="info" style="width: 16px; height: 16px; color: #9ca3af;"></i>
          </span>
        ` : '';

        // --- 1. SLIDER / SPINBOX ---
        if (['slider', 'spin', 'spinbox'].includes(widgetType)) {
          const min = param.rangeConfig?.min || 0;
          const max = param.rangeConfig?.max || 100;
          const step = param.rangeConfig?.step || 1;
          const unit = param.unit || '';
          
          const item = document.createElement('div');
          item.className = 'param-item';
          item.innerHTML = `
            <div class="param-header">
              <label class="param-label">
                ${escapeHtml(label)}
                ${tooltipIcon}
              </label>
              <input type="number" class="param-value-input" value="${value}" min="${min}" max="${max}" step="${step}">
            </div>
            <input type="range" class="param-slider" value="${value}" min="${min}" max="${max}" step="${step}">
            <div class="param-range">
              <span>${min}${unit}</span>
              <span>${max}${unit}</span>
            </div>
          `;
          const slider = item.querySelector('.param-slider');
          const input = item.querySelector('.param-value-input');
          
          slider.addEventListener('input', () => { input.value = slider.value; });
          slider.addEventListener('change', () => { configurator.updateParameter(name, parseFloat(slider.value)); });
          input.addEventListener('change', () => {
            const val = parseFloat(input.value);
            if (!isNaN(val)) {
              slider.value = val;
              configurator.updateParameter(name, val);
            }
          });
          paramsContainer.appendChild(item);
        }
        // --- 2. ROBUSTE DROPDOWN / SELECT ---
        else if (
          ['dropdown', 'select', 'choice'].includes(widgetType) || 
          (param.options && param.options.length > 0) || 
          (param.dropdownOptions && param.dropdownOptions.length > 0) ||
          (param.allowedValues && param.allowedValues.length > 0)
        ) {
          // Finde die Optionen, egal wie sie heiÃŸen
          const options = param.dropdownOptions || param.options || param.allowedValues || [];
          
          let currentLabel = value;
          const currentOption = options.find(opt => {
            const optValue = (typeof opt === 'object' && opt !== null) ? opt.value : opt;
            return String(optValue) === String(value);
          });
          if (currentOption) {
            currentLabel = (typeof currentOption === 'object' && currentOption !== null) ? (currentOption.label || currentOption.value) : currentOption;
          }
          
          const item = document.createElement('div');
          item.className = 'param-item';
          item.innerHTML = `
            <div class="param-header">
              <label class="param-label">
                ${escapeHtml(label)}
                ${tooltipIcon}
              </label>
            </div>
            <div class="param-custom-select" data-param-name="${escapeHtml(name)}">
              <button type="button" class="param-select-trigger">
                <span class="param-select-value">${escapeHtml(String(currentLabel))}</span>
                <i data-feather="chevron-down" class="param-select-arrow"></i>
              </button>
              <div class="param-select-dropdown">
                ${options.map(opt => {
                  const optValue = (typeof opt === 'object' && opt !== null) ? (opt.value !== undefined ? opt.value : opt) : opt;
                  const optLabel = (typeof opt === 'object' && opt !== null) ? (opt.label !== undefined ? opt.label : opt.value) : opt;
                  const isSelected = String(optValue) === String(value);
                  return `<div class="param-select-option ${isSelected ? 'selected' : ''}" data-value="${escapeHtml(String(optValue))}">${escapeHtml(String(optLabel))}</div>`;
                }).join('')}
              </div>
            </div>
          `;
          
          const trigger = item.querySelector('.param-select-trigger');
          const dropdown = item.querySelector('.param-select-dropdown');
          const valueDisplay = item.querySelector('.param-select-value');
          const optionElements = item.querySelectorAll('.param-select-option');

          // WICHTIG: Dropdown an body anhÃ¤ngen gegen Clipping
          document.body.appendChild(dropdown);

          trigger.addEventListener('click', (e) => {
            e.stopPropagation();
            // Andere offene Dropdowns schlieÃŸen
            document.querySelectorAll('.param-select-dropdown.active').forEach(d => { if(d !== dropdown) d.classList.remove('active'); });
            document.querySelectorAll('.param-select-trigger.active').forEach(t => { if(t !== trigger) t.classList.remove('active'); });

            const isOpening = !dropdown.classList.contains('active');
            dropdown.classList.toggle('active', isOpening);
            trigger.classList.toggle('active', isOpening);

            if (isOpening) {
              const rect = trigger.getBoundingClientRect();
              dropdown.style.position = 'absolute';
              dropdown.style.top = `${rect.bottom + window.scrollY + 4}px`;
              dropdown.style.left = `${rect.left + window.scrollX}px`;
              dropdown.style.width = `${rect.width}px`;
              dropdown.style.zIndex = '2147483647'; // Max Z-Index
            }
          });

          optionElements.forEach(optionEl => {
            optionEl.addEventListener('click', (e) => {
              e.stopPropagation();
              const selectedValue = optionEl.dataset.value;
              valueDisplay.textContent = optionEl.textContent;
              optionElements.forEach(o => o.classList.remove('selected'));
              optionEl.classList.add('selected');
              dropdown.classList.remove('active');
              trigger.classList.remove('active');

              // Typ-Erhaltung versuchen
              let finalValue = selectedValue;
              if (!isNaN(parseFloat(selectedValue)) && isFinite(selectedValue)) {
                  finalValue = parseFloat(selectedValue);
              }
              configurator.updateParameter(name, finalValue);
            });
          });
          
          paramsContainer.appendChild(item);
        }
        // --- 3. CHECKBOX ---
        else if (['checkbox', 'bool', 'boolean'].includes(widgetType)) {
          const item = document.createElement('div');
          item.className = 'param-item param-item-checkbox';
          item.innerHTML = `
            <label class="param-checkbox-label">
              <input type="checkbox" class="param-checkbox" ${value ? 'checked' : ''}>
              <span class="param-checkbox-text">
                ${escapeHtml(label)}
                ${tooltipIcon}
              </span>
            </label>
          `;
          const checkbox = item.querySelector('.param-checkbox');
          checkbox.addEventListener('change', () => {
            configurator.updateParameter(name, checkbox.checked);
          });
          paramsContainer.appendChild(item);
        }
        // --- 4. TEXTAREA ---
        else if (['textarea', 'multiline'].includes(widgetType)) {
          const item = document.createElement('div');
          item.className = 'param-item';
          item.innerHTML = `
            <div class="param-header">
              <label class="param-label">
                ${escapeHtml(label)}
                ${tooltipIcon}
              </label>
            </div>
            <textarea class="param-textarea" rows="3">${escapeHtml(value || '')}</textarea>
          `;
          const textarea = item.querySelector('.param-textarea');
          textarea.addEventListener('change', () => {
            configurator.updateParameter(name, textarea.value);
          });
          paramsContainer.appendChild(item);
        }
        // --- 5. DEFAULT TEXT INPUT ---
        else {
          const item = document.createElement('div');
          item.className = 'param-item';
          item.innerHTML = `
            <div class="param-header">
              <label class="param-label">
                ${escapeHtml(label)}
                ${tooltipIcon}
              </label>
            </div>
            <input type="text" class="param-text-input" value="${escapeHtml(String(value || ''))}">
          `;
          const input = item.querySelector('.param-text-input');
          input.addEventListener('change', () => {
            configurator.updateParameter(name, input.value);
          });
          paramsContainer.appendChild(item);
        }
      });
      
      refreshIcons();
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function handleError(error) {
      const message = error?.message || 'An error occurred';
      console.error('[Prinjekt] Error:', error);
      showToast(`Error: ${message}`, 'error');
    }
    
    init();
  })();
});
</script>


{% schema %}
{
  "name": "Prinjekt Ultimate Mobile",
  "tag": "section",
  "class": "prinjekt-section",
  "settings": [
    {
      "type": "header",
      "content": "ðŸ”Œ API Settings"
    },
    {
      "type": "text",
      "id": "api_base_url",
      "label": "API Base URL",
      "default": "https://prinjekt.duckdns.org/shopify-app/prototype/models"
    },
    {
      "type": "text",
      "id": "default_price",
      "label": "Default Price",
      "default": "0.00"
    },
    {
      "type": "text",
      "id": "shipping_time",
      "label": "Shipping Time",
      "default": "5-7 business days"
    },
    {
      "type": "header",
      "content": "ðŸ“ Layout & Spacing"
    },
    {
      "type": "range",
      "id": "container_max_width",
      "label": "Container Max Width",
      "min": 1000,
      "max": 2000,
      "step": 50,
      "unit": "px",
      "default": 1600
    },
    {
      "type": "range",
      "id": "container_padding",
      "label": "Container Padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "column_gap",
      "label": "Column Gap (Desktop)",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "row_gap",
      "label": "Row Gap (Mobile)",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 24
    },
    {
      "type": "header",
      "content": "ðŸŽ¨ Colors"
    },
    {
      "type": "color",
      "id": "bg_gradient_from",
      "label": "Background Gradient Start",
      "default": "#f9fafb"
    },
    {
      "type": "color",
      "id": "bg_gradient_to",
      "label": "Background Gradient End",
      "default": "#f3f4f6"
    },
    {
      "type": "color",
      "id": "text_color_primary",
      "label": "Primary Text Color",
      "default": "#111827"
    },
    {
      "type": "color",
      "id": "text_color_secondary",
      "label": "Secondary Text Color",
      "default": "#6b7280"
    },
    {
      "type": "color",
      "id": "text_color_muted",
      "label": "Muted Text Color",
      "default": "#9ca3af"
    },
    {
      "type": "header",
      "content": "ðŸ–¼ï¸ 3D Viewer"
    },
    {
      "type": "text",
      "id": "viewer_aspect_ratio",
      "label": "Aspect Ratio (Desktop)",
      "default": "1 / 1",
      "info": "Format: width / height (e.g., 16 / 9 or 1 / 1)"
    },
    {
      "type": "text",
      "id": "viewer_aspect_ratio_mobile",
      "label": "Aspect Ratio (Mobile)",
      "default": "3 / 4",
      "info": "Recommended: 3 / 4 for portrait mobile"
    },
    {
      "type": "color",
      "id": "viewer_background",
      "label": "Viewer Background",
      "default": "#F3F4F6"
    },
    {
      "type": "color",
      "id": "viewer_gradient_to",
      "label": "Viewer Gradient End",
      "default": "#e5e7eb"
    },
    {
      "type": "range",
      "id": "viewer_border_radius",
      "label": "Border Radius",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "viewer_shadow_x",
      "label": "Shadow X Offset",
      "min": -20,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "viewer_shadow_y",
      "label": "Shadow Y Offset",
      "min": 0,
      "max": 30,
      "step": 1,
      "unit": "px",
      "default": 10
    },
    {
      "type": "range",
      "id": "viewer_shadow_blur",
      "label": "Shadow Blur",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 15
    },
    {
      "type": "range",
      "id": "viewer_shadow_spread",
      "label": "Shadow Spread",
      "min": -20,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": -3
    },
    {
      "type": "range",
      "id": "viewer_shadow_opacity",
      "label": "Shadow Opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 10
    },
    {
      "type": "checkbox",
      "id": "show_grid",
      "label": "Show Grid",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_axes",
      "label": "Show Axes",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_shadows",
      "label": "Enable Shadows",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "auto_rotate",
      "label": "Auto Rotate",
      "default": false
    },
    {
      "type": "header",
      "content": "ðŸƒ Cards"
    },
    {
      "type": "color",
      "id": "card_bg_color",
      "label": "Card Background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "label": "Border Radius",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "card_padding",
      "label": "Padding",
      "min": 8,
      "max": 64,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "card_margin_bottom",
      "label": "Spacing Between Cards",
      "min": 0,
      "max": 64,
      "step": 4,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "card_shadow_x",
      "label": "Shadow X Offset",
      "min": -20,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "card_shadow_y",
      "label": "Shadow Y Offset",
      "min": 0,
      "max": 30,
      "step": 1,
      "unit": "px",
      "default": 10
    },
    {
      "type": "range",
      "id": "card_shadow_blur",
      "label": "Shadow Blur",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 15
    },
    {
      "type": "range",
      "id": "card_shadow_spread",
      "label": "Shadow Spread",
      "min": -20,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": -3
    },
    {
      "type": "range",
      "id": "card_shadow_opacity",
      "label": "Shadow Opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 10
    },
    {
      "type": "header",
      "content": "âœï¸ Typography"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "label": "Title Font Size",
      "min": 16,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "title_font_weight",
      "label": "Title Font Weight",
      "min": 400,
      "max": 900,
      "step": 100,
      "default": 700
    },
    {
      "type": "text",
      "id": "title_line_height",
      "label": "Title Line Height",
      "default": "1.2"
    },
    {
      "type": "range",
      "id": "subtitle_font_size",
      "label": "Subtitle Font Size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "subtitle_font_weight",
      "label": "Subtitle Font Weight",
      "min": 400,
      "max": 700,
      "step": 100,
      "default": 400
    },
    {
      "type": "range",
      "id": "price_font_size",
      "label": "Price Font Size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "price_font_weight",
      "label": "Price Font Weight",
      "min": 400,
      "max": 900,
      "step": 100,
      "default": 700
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price Color",
      "default": "#111827"
    },
    {
      "type": "header",
      "content": "ðŸ”˜ Primary Button (Add to Cart)"
    },
    {
      "type": "color",
      "id": "button_primary_bg",
      "label": "Background Color",
      "default": "#111827"
    },
    {
      "type": "color",
      "id": "button_primary_text",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "button_primary_radius",
      "label": "Border Radius",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "default": 12
    },
    {
      "type": "range",
      "id": "button_primary_padding_y",
      "label": "Padding Top/Bottom",
      "min": 8,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "button_primary_padding_x",
      "label": "Padding Left/Right",
      "min": 16,
      "max": 64,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "button_primary_font_size",
      "label": "Font Size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "header",
      "content": "âš¡ Secondary Button (Update Preview)"
    },
    {
      "type": "color",
      "id": "button_secondary_bg",
      "label": "Background Color",
      "default": "#f59e0b"
    },
    {
      "type": "color",
      "id": "button_secondary_text",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "button_secondary_radius",
      "label": "Border Radius",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "default": 12
    },
    {
      "type": "range",
      "id": "button_secondary_padding_y",
      "label": "Padding Top/Bottom",
      "min": 8,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "button_secondary_padding_x",
      "label": "Padding Left/Right",
      "min": 16,
      "max": 64,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "header",
      "content": "ðŸ“ Input Fields"
    },
    {
      "type": "color",
      "id": "input_bg",
      "label": "Background Color",
      "default": "#f9fafb"
    },
    {
      "type": "color",
      "id": "input_border",
      "label": "Border Color",
      "default": "#e5e7eb"
    },
    {
      "type": "range",
      "id": "input_border_width",
      "label": "Border Width",
      "min": 0,
      "max": 5,
      "step": 1,
      "unit": "px",
      "default": 1
    },
    {
      "type": "range",
      "id": "input_border_radius",
      "label": "Border Radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "input_padding_y",
      "label": "Padding Top/Bottom",
      "min": 4,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "input_padding_x",
      "label": "Padding Left/Right",
      "min": 8,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 12
    },
    {
      "type": "range",
      "id": "input_font_size",
      "label": "Font Size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "header",
      "content": "ðŸŽ›ï¸ Parameter Items"
    },
    {
      "type": "color",
      "id": "param_item_bg",
      "label": "Background Color",
      "default": "#f9fafb"
    },
    {
      "type": "color",
      "id": "param_item_border",
      "label": "Border Color",
      "default": "#e5e7eb"
    },
    {
      "type": "range",
      "id": "param_item_radius",
      "label": "Border Radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "default": 12
    },
    {
      "type": "range",
      "id": "param_item_padding",
      "label": "Padding",
      "min": 8,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "param_item_margin_bottom",
      "label": "Spacing Between Items",
      "min": 0,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "header",
      "content": "ðŸŽšï¸ Sliders"
    },
    {
      "type": "range",
      "id": "slider_height",
      "label": "Track Height",
      "min": 2,
      "max": 12,
      "step": 1,
      "unit": "px",
      "default": 6
    },
    {
      "type": "range",
      "id": "slider_thumb_size",
      "label": "Thumb Size (Desktop)",
      "min": 12,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 18
    },
    {
      "type": "range",
      "id": "slider_thumb_size_mobile",
      "label": "Thumb Size (Mobile)",
      "min": 16,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "color",
      "id": "slider_track_color",
      "label": "Track Color",
      "default": "#e5e7eb"
    },
    {
      "type": "color",
      "id": "slider_thumb_color",
      "label": "Thumb Color",
      "default": "#111827"
    },
    {
      "type": "header",
      "content": "ðŸ·ï¸ Badges & Status"
    },
    {
      "type": "color",
      "id": "badge_bg",
      "label": "Badge Background",
      "default": "#111827"
    },
    {
      "type": "color",
      "id": "badge_text",
      "label": "Badge Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "badge_padding_y",
      "label": "Padding Top/Bottom",
      "min": 4,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "badge_padding_x",
      "label": "Padding Left/Right",
      "min": 8,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "badge_font_size",
      "label": "Font Size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "badge_border_radius",
      "label": "Border Radius",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 100,
      "info": "Use 100 for pill shape"
    },
    {
      "type": "header",
      "content": "ðŸ“± Mobile Bottom Sheet"
    },
    {
      "type": "range",
      "id": "mobile_sheet_height",
      "label": "Sheet Height",
      "min": 50,
      "max": 90,
      "step": 5,
      "unit": "vh",
      "default": 60
    },
    {
      "type": "color",
      "id": "mobile_sheet_bg",
      "label": "Sheet Background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "mobile_sheet_radius",
      "label": "Sheet Border Radius",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "mobile_sticky_bar_height",
      "label": "Sticky Bar Height",
      "min": 60,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 72
    },
    {
      "type": "color",
      "id": "mobile_sheet_handle_bg",
      "label": "Sheet Handle Color",
      "default": "#d1d5db"
    },
    {
      "type": "text",
      "id": "mobile_price_label",
      "label": "Mobile Price Label",
      "default": "Total"
    },
    {
      "type": "text",
      "id": "mobile_configure_text",
      "label": "Mobile Configure Button Text",
      "default": "Configure"
    },
    {
      "type": "header",
      "content": "âš™ï¸ Animations"
    },
    {
      "type": "range",
      "id": "transition_speed",
      "label": "Transition Speed",
      "min": 0,
      "max": 1000,
      "step": 50,
      "unit": "ms",
      "default": 200
    },
    {
      "type": "header",
      "content": "ðŸ“± Text Content"
    },
    {
      "type": "text",
      "id": "product_title_fallback",
      "label": "Product Title Fallback",
      "default": "Custom 3D Product"
    },
    {
      "type": "textarea",
      "id": "product_description",
      "label": "Product Description",
      "default": "Configure your product using the parameters below. Adjust the settings and click \"Update Preview\" to see your changes in 3D."
    },
    {
      "type": "header",
      "content": "âœ¨ USP Section (Desktop Only)"
    },
    {
      "type": "text",
      "id": "usp_1_title",
      "label": "USP 1 Title",
      "default": "Fast Production"
    },
    {
      "type": "text",
      "id": "usp_1_description",
      "label": "USP 1 Description",
      "default": "Ready to ship in 5-7 business days"
    },
    {
      "type": "text",
      "id": "usp_2_title",
      "label": "USP 2 Title",
      "default": "Free Shipping"
    },
    {
      "type": "text",
      "id": "usp_2_description",
      "label": "USP 2 Description",
      "default": "Free delivery on all orders"
    },
    {
      "type": "text",
      "id": "usp_3_title",
      "label": "USP 3 Title",
      "default": "Quality Guarantee"
    },
    {
      "type": "text",
      "id": "usp_3_description",
      "label": "USP 3 Description",
      "default": "100% satisfaction or money back"
    },
    {
      "type": "text",
      "id": "placeholder_title",
      "label": "Placeholder Title",
      "default": "3D Preview"
    },
    {
      "type": "text",
      "id": "placeholder_subtitle",
      "label": "Placeholder Subtitle",
      "default": "Configure your product parameters"
    },
    {
      "type": "text",
      "id": "placeholder_hint",
      "label": "Placeholder Hint",
      "default": "Click \"Update Preview\" to generate the 3D model"
    },
    {
      "type": "text",
      "id": "loading_text",
      "label": "Loading Text",
      "default": "Initializing..."
    },
    {
      "type": "text",
      "id": "settings_menu_title",
      "label": "Settings Menu Title",
      "default": "VIEWER SETTINGS"
    },
    {
      "type": "text",
      "id": "settings_grid_label",
      "label": "Settings: Grid Label",
      "default": "Grid"
    },
    {
      "type": "text",
      "id": "settings_axes_label",
      "label": "Settings: Axes Label",
      "default": "Axes"
    },
    {
      "type": "text",
      "id": "settings_rotate_label",
      "label": "Settings: Auto Rotate Label",
      "default": "Auto Rotate"
    },
    {
      "type": "text",
      "id": "settings_wireframe_label",
      "label": "Settings: Wireframe Label",
      "default": "Wireframe"
    },
    {
      "type": "text",
      "id": "save_config_text",
      "label": "Save Configuration Text",
      "default": "Save Configuration"
    },
    {
      "type": "text",
      "id": "load_config_text",
      "label": "Load Configuration Text",
      "default": "Load Configuration"
    },
    {
      "type": "text",
      "id": "settings_save_config_label",
      "label": "Settings: Save Configuration Label",
      "default": "Save Configuration"
    },
    {
      "type": "text",
      "id": "settings_load_config_label",
      "label": "Settings: Load Configuration Label",
      "default": "Load Configuration"
    },
    {
      "type": "text",
      "id": "model_loaded_text",
      "label": "Model Loaded Text",
      "default": "3D Model Loaded"
    },
    {
      "type": "text",
      "id": "config_summary_label",
      "label": "Config Summary Label",
      "default": "Current Configuration"
    },
    {
      "type": "text",
      "id": "pending_updates_text",
      "label": "Pending Updates Text",
      "default": "Updates pending"
    },
    {
      "type": "text",
      "id": "helper_text",
      "label": "Helper Text",
      "default": "Click and drag to rotate â€¢ Scroll to zoom"
    },
    {
      "type": "text",
      "id": "reset_button_text",
      "label": "Reset Button Text",
      "default": "Reset"
    },
    {
      "type": "text",
      "id": "price_vat_text",
      "label": "Price VAT Text",
      "default": "incl. VAT"
    },
    {
      "type": "text",
      "id": "shipping_label_prefix",
      "label": "Shipping Label Prefix",
      "default": "Ships in"
    },
    {
      "type": "text",
      "id": "shipping_free_text",
      "label": "Free Shipping Text",
      "default": "Free shipping"
    },
    {
      "type": "text",
      "id": "params_heading",
      "label": "Parameters Heading",
      "default": "Configure Your Product"
    },
    {
      "type": "text",
      "id": "update_button_text",
      "label": "Update Button Text",
      "default": "Update Preview"
    },
    {
      "type": "text",
      "id": "total_price_label",
      "label": "Total Price Label",
      "default": "Total Price"
    },
    {
      "type": "text",
      "id": "delivery_label",
      "label": "Delivery Label",
      "default": "Delivery"
    },
    {
      "type": "text",
      "id": "add_to_cart_text",
      "label": "Add to Cart Text",
      "default": "Add to Cart"
    },
    {
      "type": "text",
      "id": "cart_warning_text",
      "label": "Cart Warning Text",
      "default": "Please update the preview before adding to cart"
    },
    {
      "type": "text",
      "id": "placeholder_loading_text",
      "label": "Placeholder Loading Text",
      "default": "Loading 3D model..."
    },
    {
      "type": "text",
      "id": "placeholder_loading_subtext",
      "label": "Placeholder Loading Subtext",
      "default": "Preparing your configuration"
    }
  ],
  "presets": [
    {
      "name": "Prinjekt Ultimate Mobile"
    }
  ]
}
{% endschema %}
