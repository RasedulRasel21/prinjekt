{{ 'materialubersicht.css' | asset_url | stylesheet_tag }}

<div class="fdm-materials-section" style="--fdm-pad-y: {{ section.settings.padding_y }}px;">
  <div class="fdm-container">
    <div class="fdm-header">
      <h2 class="fdm-title">{{ section.settings.section_title }}</h2>
      <div class="fdm-description">{{ section.settings.section_description }}</div>
    </div>

    <div class="fdm-materials-list">
      {% for block in section.blocks %}
        <div class="fdm-material-item" {{ block.shopify_attributes }}>
          <h3 class="fdm-material-name">{{ block.settings.material_name }}</h3>
          <button class="fdm-mehr-btn" data-modal-trigger="{{ block.id }}">
            {{ block.settings.button_text }}
          </button>
        </div>

        <!-- Modal -->
        <div class="fdm-modal" id="modal-{{ block.id }}">
          <div class="fdm-modal-content">
            <button class="fdm-modal-close" data-modal-close="{{ block.id }}">&times;</button>
            
            <div class="fdm-modal-header">
              <div class="fdm-modal-text">
                <h2 class="fdm-modal-title">{{ block.settings.material_name }}</h2>
                <div class="fdm-modal-description">{{ block.settings.description }}</div>
                {% if block.settings.applications != blank %}
                  <p class="fdm-modal-applications">{{ block.settings.applications }}</p>
                {% endif %}
              </div>
              {% if block.settings.popup_image %}
                <div class="fdm-modal-image">
                  <img src="{{ block.settings.popup_image | img_url: '400x' }}" alt="{{ block.settings.material_name }}">
                </div>
              {% endif %}
            </div>

            <div class="fdm-modal-body">
              <div class="fdm-technical-details">
                <h3>Technische Details</h3>
                <div class="fdm-tech-table">
                  {% if block.settings.weight != blank %}
                    <div class="fdm-tech-row">
                      <span class="fdm-tech-label">Gewicht g/cm3</span>
                      <span class="fdm-tech-value">{{ block.settings.weight }}</span>
                    </div>
                  {% endif %}
                  {% if block.settings.elongation != blank %}
                    <div class="fdm-tech-row">
                      <span class="fdm-tech-label">Elongation at Break</span>
                      <span class="fdm-tech-value">{{ block.settings.elongation }}</span>
                    </div>
                  {% endif %}
                  {% if block.settings.tensile_strength != blank %}
                    <div class="fdm-tech-row">
                      <span class="fdm-tech-label">Tensile Strength</span>
                      <span class="fdm-tech-value">{{ block.settings.tensile_strength }}</span>
                    </div>
                  {% endif %}
                  {% if block.settings.flexural_modulus != blank %}
                    <div class="fdm-tech-row">
                      <span class="fdm-tech-label">Flexural Modulus</span>
                      <span class="fdm-tech-value">{{ block.settings.flexural_modulus }}</span>
                    </div>
                  {% endif %}
                  {% if block.settings.heat_distortion != blank %}
                    <div class="fdm-tech-row">
                      <span class="fdm-tech-label">Heat Distortion Temperature</span>
                      <span class="fdm-tech-value">{{ block.settings.heat_distortion }}</span>
                    </div>
                  {% endif %}
                </div>

                {% if block.settings.datasheet_url != blank %}
                  <div>
                    <a href="{{ block.settings.datasheet_url }}" class="fdm-datasheet-btn" target="_blank" rel="noopener noreferrer">
                      Technisches Datenblatt
                    </a>
                  </div>
                {% endif %}
              </div>

              <div>
                {% if block.settings.color_swatch %}
                  <div class="fdm-color-section">
                    <h3>Farbe</h3>
                    <div class="fdm-color-swatch" style="background-color: {{ block.settings.color_swatch }};"></div>
                  </div>
                {% endif %}

                {% if block.settings.advantage_1 != blank or block.settings.advantage_2 != blank %}
                  <div class="fdm-vorteile-section">
                    <h3>Vorteile</h3>
                    <ul>
                      {% if block.settings.advantage_1 != blank %}
                        <li>{{ block.settings.advantage_1 }}</li>
                      {% endif %}
                      {% if block.settings.advantage_2 != blank %}
                        <li>{{ block.settings.advantage_2 }}</li>
                      {% endif %}
                    </ul>
                  </div>
                {% endif %}

                {% if block.settings.disadvantage_1 != blank or block.settings.disadvantage_2 != blank %}
                  <div class="fdm-nachteile-section">
                    <h3>Nachteile</h3>
                    <ul>
                      {% if block.settings.disadvantage_1 != blank %}
                        <li>{{ block.settings.disadvantage_1 }}</li>
                      {% endif %}
                      {% if block.settings.disadvantage_2 != blank %}
                        <li>{{ block.settings.disadvantage_2 }}</li>
                      {% endif %}
                    </ul>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Open modal
    document.querySelectorAll('[data-modal-trigger]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        const modalId = 'modal-' + this.getAttribute('data-modal-trigger');
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.add('active');
          document.body.style.overflow = 'hidden';
        }
      });
    });

    // Close modal
    document.querySelectorAll('[data-modal-close]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        const modalId = 'modal-' + this.getAttribute('data-modal-close');
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.remove('active');
          document.body.style.overflow = '';
        }
      });
    });

    // Close modal on outside click
    document.querySelectorAll('.fdm-modal').forEach(function(modal) {
      modal.addEventListener('click', function(e) {
        if (e.target === this) {
          this.classList.remove('active');
          document.body.style.overflow = '';
        }
      });
    });

    // Close modal on ESC key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.querySelectorAll('.fdm-modal.active').forEach(function(modal) {
          modal.classList.remove('active');
          document.body.style.overflow = '';
        });
      }
    });
  });
</script>

{% schema %}
{
  "name": "3D-Druck Materialien",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "3D-Druck Materialien für FDM"
    },
    {
      "type": "richtext",
      "id": "section_description",
      "label": "Section Description",
      "default": "<p>FDM steht für „Fused Deposition Modeling und ist ein Verfahren zum 3D-Drucken von Objekten. Dabei wird ein thermoplastischer Faden durch eine Düse geleitet, die ihn erhitzt und schichtweise auf eine Bauplattform aufbringt. Der Faden wird dabei Schicht für Schicht aufgetragen und erstarrt, wodurch das gewünschte Objekt entsteht. FDM ist ein sehr verbreitetes und kosteneffizientes Verfahren, das sowohl in der industriellen Produktion als auch im privaten Bereich verwendet wird.</p>"
    },
    {
      "type": "range",
      "id": "padding_y",
      "label": "Vertical padding (top & bottom)",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "default": 60
    }
  ],
  "blocks": [
    {
      "type": "material",
      "name": "Material",
      "settings": [
        {
          "type": "text",
          "id": "material_name",
          "label": "Material Name",
          "default": "ABS"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button Text",
          "default": "Mehr erfahren"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>ABS Filament für 3D Drucker (Acrylnitril-Butadien-Styrol) ist ein synthetisches Terpolymer und gehört zu den amorphen Thermoplasten.</p>"
        },
        {
          "type": "image_picker",
          "id": "popup_image",
          "label": "Popup Image"
        },
        {
          "type": "text",
          "id": "applications",
          "label": "Applications",
          "default": "Automobilteile, Elektronikgehäuse, Spielzeug"
        },
        {
          "type": "text",
          "id": "weight",
          "label": "Gewicht g/cm3",
          "default": "1,06g"
        },
        {
          "type": "text",
          "id": "elongation",
          "label": "Elongation at Break",
          "default": "30%"
        },
        {
          "type": "text",
          "id": "tensile_strength",
          "label": "Tensile Strength",
          "default": "40 MPa"
        },
        {
          "type": "text",
          "id": "flexural_modulus",
          "label": "Flexural Modulus",
          "default": "1203 MPa"
        },
        {
          "type": "text",
          "id": "heat_distortion",
          "label": "Heat Distortion Temperature",
          "default": "73°C"
        },
        {
          "type": "color",
          "id": "color_swatch",
          "label": "Color Swatch",
          "default": "#000000"
        },
        {
          "type": "text",
          "id": "advantage_1",
          "label": "Advantage 1",
          "default": "Hohe Festigkeit"
        },
        {
          "type": "text",
          "id": "advantage_2",
          "label": "Advantage 2",
          "default": "gute Temperaturbeständigkeit"
        },
        {
          "type": "text",
          "id": "disadvantage_1",
          "label": "Disadvantage 1",
          "default": "Hohe Festigkeit"
        },
        {
          "type": "text",
          "id": "disadvantage_2",
          "label": "Disadvantage 2",
          "default": "gute Temperaturbeständigkeit"
        },
        {
          "type": "url",
          "id": "datasheet_url",
          "label": "Technical Datasheet URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "3D-Druck Materialien",
      "blocks": [
        {
          "type": "material",
          "settings": {
            "material_name": "ABS"
          }
        },
        {
          "type": "material",
          "settings": {
            "material_name": "ASA"
          }
        },
        {
          "type": "material",
          "settings": {
            "material_name": "Green-TEC"
          }
        }
      ]
    }
  ]
}
{% endschema %}